<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>♠️ Professional Poker - XCrazyBet</title>
    
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Roboto+Mono:wght@300;400&display=swap" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --primary: #ff4081;
            --primary-dark: #d81b60;
            --secondary: #2196f3;
            --success: #4caf50;
            --danger: #ff5252;
            --warning: #ff9800;
            --dark-bg: #0f0c29;
            --medium-bg: #1a1a2e;
            --light-bg: #24243e;
            --text: #ffffff;
            --text-secondary: #b0b0b0;
            --chip-1: #ff4081;
            --chip-5: #2196f3;
            --chip-10: #4caf50;
            --chip-25: #ff9800;
            --chip-100: #9c27b0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, var(--dark-bg), var(--light-bg));
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 28px;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-btn {
            padding: 10px 20px;
            background: var(--medium-bg);
            border-radius: 8px;
            color: var(--text);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            border: 1px solid transparent;
        }

        .nav-btn:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: var(--primary);
            border-color: var(--text);
        }

        .balance-display {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* Home Button */
        .home-btn {
            background: var(--primary);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 20px;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .home-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        /* Main Layout */
        .container {
            display: flex;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            gap: 20px;
            min-height: calc(100vh - 80px);
        }

        /* Sidebar */
        .sidebar {
            flex: 0 0 300px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid var(--primary);
            height: fit-content;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 1px solid var(--primary);
            padding-bottom: 8px;
        }

        /* Player Info Form */
        .player-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .form-input {
            padding: 12px;
            background: var(--medium-bg);
            border: 1px solid var(--light-bg);
            border-radius: 8px;
            color: var(--text);
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .select-wrapper {
            position: relative;
        }

        .select-wrapper select {
            appearance: none;
            width: 100%;
            padding: 12px;
            background: var(--medium-bg);
            border: 1px solid var(--light-bg);
            border-radius: 8px;
            color: var(--text);
            cursor: pointer;
        }

        .select-wrapper::after {
            content: '▼';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            pointer-events: none;
        }

        /* Top Winners */
        .winners-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .winner-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .winner-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .winner-name {
            font-weight: 500;
        }

        .winner-amount {
            color: var(--success);
            font-weight: 600;
        }

        /* Main Game Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Poker Table */
        .poker-table {
            flex: 1;
            background: radial-gradient(circle, #0a5c36 0%, #05422a 70%, #032017 100%);
            border-radius: 50%;
            border: 15px solid #8b4513;
            box-shadow: 
                0 0 0 10px #654321,
                inset 0 0 50px rgba(0, 0, 0, 0.5),
                0 10px 50px rgba(0, 0, 0, 0.8);
            position: relative;
            overflow: hidden;
            min-height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .table-center {
            position: absolute;
            width: 40%;
            height: 40%;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .pot-display {
            font-size: 24px;
            font-weight: 700;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .community-cards {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* Player Seats */
        .player-seat {
            position: absolute;
            width: 120px;
            height: 140px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            border: 2px solid var(--primary);
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .player-seat.active {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            transform: scale(1.05);
        }

        .player-seat.dealer {
            border-color: var(--secondary);
        }

        .player-name {
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-stack {
            color: var(--success);
            font-size: 12px;
        }

        .player-cards {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 10px 0;
        }

        .player-actions {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 11px;
        }

        /* Card Styles */
        .card {
            width: 40px;
            height: 60px;
            background: white;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            color: black;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .card.red {
            color: #d50000;
        }

        .card.black {
            color: #000;
        }

        .card.back {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            font-size: 10px;
        }

        .card-rank {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 14px;
        }

        .card-suit {
            font-size: 20px;
        }

        /* Action Controls */
        .action-controls {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid var(--primary);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .action-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-fold {
            background: var(--danger);
            color: white;
        }

        .btn-check {
            background: var(--text-secondary);
            color: black;
        }

        .btn-call {
            background: var(--secondary);
            color: white;
        }

        .btn-raise {
            background: var(--warning);
            color: white;
        }

        .btn-allin {
            background: linear-gradient(45deg, var(--danger), var(--primary));
            color: white;
        }

        .bet-controls {
            grid-column: 1 / -1;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .bet-input {
            flex: 1;
            padding: 15px;
            background: var(--medium-bg);
            border: 1px solid var(--primary);
            border-radius: 10px;
            color: var(--text);
            font-size: 18px;
            font-weight: 600;
        }

        .chip-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
        }

        .chip {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid white;
        }

        .chip:hover {
            transform: scale(1.1);
        }

        .chip-1 { background: var(--chip-1); }
        .chip-5 { background: var(--chip-5); }
        .chip-10 { background: var(--chip-10); }
        .chip-25 { background: var(--chip-25); }
        .chip-100 { background: var(--chip-100); }

        /* Game Info */
        .game-info {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid var(--secondary);
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .stat-box {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-top: 5px;
        }

        /* Animations */
        @keyframes chipThrow {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-50px) rotate(180deg); }
            100% { transform: translateY(0) rotate(360deg); }
        }

        @keyframes cardDeal {
            0% { transform: translateY(-100px) rotateY(0deg); opacity: 0; }
            100% { transform: translateY(0) rotateY(360deg); opacity: 1; }
        }

        @keyframes winPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .chip-animation {
            animation: chipThrow 1s ease-out;
        }

        .card-deal {
            animation: cardDeal 0.5s ease-out;
        }

        .win-animation {
            animation: winPulse 2s infinite;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            padding: 15px 20px;
            border-radius: 8px;
            background: var(--medium-bg);
            border-left: 4px solid var(--primary);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s;
            max-width: 300px;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--danger); }
        .toast.warning { border-color: var(--warning); }
        .toast.info { border-color: var(--secondary); }

        /* Responsive */
        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .player-seat {
                transform: scale(0.8);
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .action-controls {
                grid-template-columns: 1fr;
            }
            
            .player-seat {
                width: 100px;
                height: 120px;
                padding: 10px;
                font-size: 12px;
            }
            
            .card {
                width: 30px;
                height: 45px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div style="display: flex; align-items: center; gap: 15px;">
            <a href="https://xcrazybet.github.io/millioner" class="home-btn" title="Return to Home">
                <i class="fas fa-home"></i>
            </a>
            <div class="logo">
                <i class="fas fa-dice"></i>
                XCrazyBet Poker
            </div>
        </div>
        
        <div class="nav-links">
            <a href="https://xcrazybet.github.io/millioner/games.html" class="nav-btn">
                <i class="fas fa-gamepad"></i> Games
            </a>
            <a href="https://xcrazybet.github.io/millioner/bets.html" class="nav-btn">
                <i class="fas fa-coins"></i> Bets
            </a>
            <a href="https://xcrazybet.github.io/millioner/dashboard.html" class="nav-btn">
                <i class="fas fa-wallet"></i> Deposit
            </a>
        </div>
        
        <div class="balance-display" id="balanceDisplay">
            <i class="fas fa-wallet"></i> Loading...
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Player Info Form -->
            <div class="sidebar-section">
                <h3><i class="fas fa-user"></i> Player Profile</h3>
                <form class="player-form" id="playerForm">
                    <div class="form-group">
                        <label for="playerName">Display Name</label>
                        <input type="text" id="playerName" class="form-input" placeholder="Enter your name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="playerAge">Age</label>
                        <input type="number" id="playerAge" class="form-input" min="18" max="100" value="25" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="playerLevel">Skill Level</label>
                        <div class="select-wrapper">
                            <select id="playerLevel" class="form-input">
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                                <option value="professional">Professional</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="buyIn">Buy-in Amount</label>
                        <input type="number" id="buyIn" class="form-input" min="10" max="10000" value="100" required>
                    </div>
                    
                    <button type="submit" class="action-btn btn-call" style="margin-top: 10px;">
                        <i class="fas fa-play"></i> Join Table
                    </button>
                </form>
            </div>

            <!-- Top Winners -->
            <div class="sidebar-section">
                <h3><i class="fas fa-trophy"></i> Recent Winners</h3>
                <div class="winners-list" id="winnersList">
                    <!-- Filled by JavaScript -->
                </div>
            </div>

            <!-- Table Info -->
            <div class="sidebar-section">
                <h3><i class="fas fa-info-circle"></i> Table Rules</h3>
                <div style="font-size: 14px; line-height: 1.6;">
                    <p><strong>Game:</strong> Texas Hold'em</p>
                    <p><strong>Blinds:</strong> $1 / $2</p>
                    <p><strong>Max Players:</strong> 5</p>
                    <p><strong>Rake:</strong> 5% (max $10)</p>
                    <p><strong>Min Buy-in:</strong> $10</p>
                    <p><strong>Max Buy-in:</strong> $10,000</p>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Poker Table -->
            <div class="poker-table" id="pokerTable">
                <!-- Community Cards -->
                <div class="table-center">
                    <div class="pot-display" id="potDisplay">Pot: $0</div>
                    <div class="community-cards" id="communityCards">
                        <!-- Cards will be added here -->
                    </div>
                </div>
                
                <!-- Player Seats -->
                <div class="player-seat" id="seat0" style="top: 10%; left: 50%; transform: translateX(-50%);">
                    <div class="player-name">You</div>
                    <div class="player-cards">
                        <div class="card back"></div>
                        <div class="card back"></div>
                    </div>
                    <div class="player-stack">$0</div>
                    <div class="player-actions" id="seat0Actions"></div>
                </div>
                
                <div class="player-seat" id="seat1" style="top: 50%; right: 5%; transform: translateY(-50%);">
                    <div class="player-name" id="seat1Name">Player 1</div>
                    <div class="player-cards">
                        <div class="card back"></div>
                        <div class="card back"></div>
                    </div>
                    <div class="player-stack" id="seat1Stack">$100</div>
                    <div class="player-actions" id="seat1Actions"></div>
                </div>
                
                <div class="player-seat" id="seat2" style="bottom: 10%; left: 50%; transform: translateX(-50%);">
                    <div class="player-name" id="seat2Name">Player 2</div>
                    <div class="player-cards">
                        <div class="card back"></div>
                        <div class="card back"></div>
                    </div>
                    <div class="player-stack" id="seat2Stack">$100</div>
                    <div class="player-actions" id="seat2Actions"></div>
                </div>
                
                <div class="player-seat" id="seat3" style="top: 50%; left: 5%; transform: translateY(-50%);">
                    <div class="player-name" id="seat3Name">Player 3</div>
                    <div class="player-cards">
                        <div class="card back"></div>
                        <div class="card back"></div>
                    </div>
                    <div class="player-stack" id="seat3Stack">$100</div>
                    <div class="player-actions" id="seat3Actions"></div>
                </div>
                
                <div class="player-seat" id="seat4" style="top: 20%; right: 20%;">
                    <div class="player-name" id="seat4Name">Player 4</div>
                    <div class="player-cards">
                        <div class="card back"></div>
                        <div class="card back"></div>
                    </div>
                    <div class="player-stack" id="seat4Stack">$100</div>
                    <div class="player-actions" id="seat4Actions"></div>
                </div>
            </div>

            <!-- Action Controls -->
            <div class="action-controls" id="actionControls" style="display: none;">
                <button class="action-btn btn-fold" id="btnFold">
                    <i class="fas fa-times"></i> Fold
                </button>
                <button class="action-btn btn-check" id="btnCheck">
                    <i class="fas fa-check"></i> Check
                </button>
                <button class="action-btn btn-call" id="btnCall">
                    <i class="fas fa-handshake"></i> Call $0
                </button>
                <button class="action-btn btn-raise" id="btnRaise">
                    <i class="fas fa-arrow-up"></i> Raise
                </button>
                <button class="action-btn btn-allin" id="btnAllIn">
                    <i class="fas fa-fire"></i> All In
                </button>
                
                <div class="bet-controls">
                    <input type="number" class="bet-input" id="betAmount" value="0" min="0">
                    <div class="chip-selector">
                        <div class="chip chip-1" data-amount="1">$1</div>
                        <div class="chip chip-5" data-amount="5">$5</div>
                        <div class="chip chip-10" data-amount="10">$10</div>
                        <div class="chip chip-25" data-amount="25">$25</div>
                        <div class="chip chip-100" data-amount="100">$100</div>
                    </div>
                </div>
            </div>

            <!-- Game Info -->
            <div class="game-info">
                <h3 style="color: var(--primary); margin-bottom: 15px;">
                    <i class="fas fa-chart-line"></i> Game Statistics
                </h3>
                <div class="game-stats">
                    <div class="stat-box">
                        <div>Win Rate</div>
                        <div class="stat-value" id="winRate">10%</div>
                    </div>
                    <div class="stat-box">
                        <div>Total Hands</div>
                        <div class="stat-value" id="totalHands">0</div>
                    </div>
                    <div class="stat-box">
                        <div>Total Won</div>
                        <div class="stat-value" id="totalWon">$0</div>
                    </div>
                    <div class="stat-box">
                        <div>Total Lost</div>
                        <div class="stat-value" id="totalLost">$0</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ===== FIREBASE CONFIG =====
        const firebaseConfig = {
            apiKey: "AIzaSyA72Yo_YGqno9PX25p3yQBvyflcaM-NqEM",
            authDomain: "x-bet-prod-jd.firebaseapp.com",
            projectId: "x-bet-prod-jd",
            storageBucket: "x-bet-prod-jd.firebasestorage.app",
            messagingSenderId: "499334334535",
            appId: "1:499334334535:web:bebc1bf817e24d9e3c4962"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ===== GAME STATE =====
        const gameState = {
            currentUser: null,
            balance: 0,
            playerProfile: null,
            gameId: null,
            playerId: null,
            isPlaying: false,
            currentHand: null,
            players: [],
            deck: [],
            communityCards: [],
            pot: 0,
            dealerPosition: 0,
            currentPlayer: null,
            winners: [],
            gameStats: {
                totalHands: 0,
                totalWon: 0,
                totalLost: 0
            },
            // Balance synchronization
            mainBalance: 0,
            gameBalance: 0
        };

        // ===== 100 RANDOM PLAYER NAMES =====
        const playerNames = [
            "Ace_High", "BluffMaster", "CardShark", "PokerFace", "RoyalFlush",
            "All_In_Andy", "ChipLeader", "DealerDave", "FoldKing", "RiverRat",
            "TurnPro", "FlopGod", "StackAttack", "SlowRoller", "QuickFold",
            "Maverick", "VegasVic", "TexasTom", "HoldemHero", "BlindBandit",
            "ChipChaser", "PotHunter", "RaiseKing", "CallStation", "TightTony",
            "LooseLucy", "AggroAl", "NitNeil", "SharkSteve", "FishFrank",
            "BullyBob", "RockyRob", "SpewySam", "LaggyLarry", "TaggyTim",
            "Reggie", "DonkDan", "WhaleWally", "ProPaul", "SemiProSue",
            "GrinderGus", "SwingerSid", "ManiacMike", "SolidSally", "WildBill",
            "CoolerCarl", "SuckoutSam", "BadBeatBetty", "LuckyLou", "UnluckyUrsula",
            "HotStreakHank", "ColdDeckCarl", "HeaterHarry", "IceVeinsIvy", "SteelNervesStan",
            "PokerProPete", "OnlineOllie", "LiveLarry", "TourneyTom", "CashGameChris",
            "SitNGoSue", "SpinNGoSam", "MTTMike", "HeadsUpHank", "FullRingFrank",
            "ShortStackSteve", "DeepStackDave", "MiddleMike", "ButtonBob", "BlindBrenda",
            "CutoffCarl", "HijackHarry", "LojackLarry", "UTG_Ursula", "EP_Eddie",
            "MP_Mike", "CO_Cathy", "BTN_Bob", "SB_Sally", "BB_Bob",
            "UnderTheGun", "EarlyPos", "MidPos", "LatePos", "StealSpot",
            "DefendDave", "3BetBetty", "4BetFred", "5BetFran", "SqueezeSam",
            "IsolationIvy", "ContinuationCarl", "CheckRaiseRita", "FloatFred", "BarrelBetty",
            "ValueTownTom", "BluffCityCindy", "ThinValueVic", "OverbetOlga", "PotControlPaul"
        ];

        // ===== CARD DECK =====
        const suits = ['♠', '♥', '♦', '♣'];
        const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            setupEventListeners();
            loadRecentWinners();
        });

        // ===== AUTHENTICATION =====
        function checkAuth() {
            auth.onAuthStateChanged(user => {
                if (!user) {
                    showToast('Please login to play', 'error');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                    return;
                }
                gameState.currentUser = user;
                loadBalance();
            });
        }

        // ===== BALANCE MANAGEMENT =====
        async function loadBalance() {
            try {
                const doc = await db.collection("wallets").doc(gameState.currentUser.uid).get();
                if (doc.exists) {
                    gameState.mainBalance = doc.data().balance || 0;
                    gameState.balance = gameState.mainBalance;
                    updateBalanceDisplay();
                    updatePlayerName();
                } else {
                    showToast('Wallet not found. Creating new wallet...', 'warning');
                    await db.collection("wallets").doc(gameState.currentUser.uid).set({
                        balance: 100,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    });
                    gameState.mainBalance = 100;
                    gameState.balance = 100;
                    updateBalanceDisplay();
                    updatePlayerName();
                }
            } catch (error) {
                console.error('Error loading balance:', error);
                showToast('Error loading balance', 'error');
            }
        }

        function updateBalanceDisplay() {
            const balanceElement = document.getElementById('balanceDisplay');
            if (balanceElement) {
                balanceElement.innerHTML = `<i class="fas fa-wallet"></i> $${gameState.mainBalance.toFixed(2)}`;
            }
        }

        function updatePlayerName() {
            if (gameState.currentUser && gameState.currentUser.displayName) {
                document.getElementById('playerName').value = gameState.currentUser.displayName;
            } else if (gameState.currentUser && gameState.currentUser.email) {
                document.getElementById('playerName').value = gameState.currentUser.email.split('@')[0];
            }
        }

        // ===== SYNC BALANCE WITH DASHBOARD =====
        async function syncBalanceWithDashboard(transactionData) {
            try {
                const walletRef = db.collection("wallets").doc(gameState.currentUser.uid);
                
                await db.runTransaction(async (transaction) => {
                    const walletDoc = await transaction.get(walletRef);
                    
                    if (!walletDoc.exists) {
                        throw new Error("Wallet not found");
                    }
                    
                    const currentBalance = walletDoc.data().balance || 0;
                    const newBalance = currentBalance + transactionData.amount;
                    
                    if (newBalance < 0) {
                        throw new Error("Insufficient funds");
                    }
                    
                    // Update main balance
                    transaction.update(walletRef, {
                        balance: newBalance,
                        updatedAt: new Date()
                    });
                    
                    // Record transaction
                    const transactionRef = walletRef.collection("transactions").doc();
                    transaction.set(transactionRef, {
                        type: transactionData.type || "game_transaction",
                        amount: transactionData.amount,
                        description: transactionData.description || "Poker game transaction",
                        createdAt: new Date(),
                        gameId: gameState.gameId || 'poker_game',
                        beforeBalance: currentBalance,
                        afterBalance: newBalance
                    });
                    
                    // Update local balance
                    gameState.mainBalance = newBalance;
                    gameState.balance = newBalance;
                });
                
                updateBalanceDisplay();
                return true;
            } catch (error) {
                console.error('Transaction failed:', error);
                showToast('Transaction failed: ' + error.message, 'error');
                return false;
            }
        }

        // ===== PLAYER FORM =====
        function setupEventListeners() {
            document.getElementById('playerForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await joinGame();
            });

            // Action buttons
            document.getElementById('btnFold').addEventListener('click', () => playerAction('fold'));
            document.getElementById('btnCheck').addEventListener('click', () => playerAction('check'));
            document.getElementById('btnCall').addEventListener('click', () => playerAction('call'));
            document.getElementById('btnRaise').addEventListener('click', () => playerAction('raise'));
            document.getElementById('btnAllIn').addEventListener('click', () => playerAction('allin'));

            // Chip buttons
            document.querySelectorAll('.chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    const amount = parseInt(chip.dataset.amount);
                    const currentBet = parseInt(document.getElementById('betAmount').value) || 0;
                    document.getElementById('betAmount').value = currentBet + amount;
                    animateChip(chip);
                });
            });

            // Real-time balance updates
            setupBalanceListener();
        }

        // ===== REAL-TIME BALANCE LISTENER =====
        function setupBalanceListener() {
            const walletRef = db.collection("wallets").doc(gameState.currentUser?.uid);
            
            walletRef.onSnapshot((doc) => {
                if (doc.exists) {
                    const newBalance = doc.data().balance || 0;
                    if (newBalance !== gameState.mainBalance) {
                        gameState.mainBalance = newBalance;
                        gameState.balance = newBalance;
                        updateBalanceDisplay();
                        
                        // If game is active, update player's stack
                        if (gameState.isPlaying && gameState.playerId) {
                            const player = gameState.players.find(p => p.id === gameState.playerId);
                            if (player) {
                                // Update player's stack if needed
                                showToast('Balance updated from dashboard', 'info');
                            }
                        }
                    }
                }
            }, (error) => {
                console.error('Balance listener error:', error);
            });
        }

        // ===== JOIN GAME =====
        async function joinGame() {
            const playerName = document.getElementById('playerName').value;
            const playerAge = parseInt(document.getElementById('playerAge').value);
            const playerLevel = document.getElementById('playerLevel').value;
            const buyIn = parseInt(document.getElementById('buyIn').value);

            if (!playerName || playerAge < 18) {
                showToast('You must be 18+ to play', 'error');
                return;
            }

            if (buyIn > gameState.mainBalance) {
                showToast('Insufficient balance', 'error');
                return;
            }

            if (buyIn < 10 || buyIn > 10000) {
                showToast('Buy-in must be between $10 and $10,000', 'error');
                return;
            }

            // Create player profile
            gameState.playerProfile = {
                name: playerName,
                age: playerAge,
                level: playerLevel,
                buyIn: buyIn,
                joinedAt: new Date()
            };

            // Deduct buy-in from main balance
            showToast('Joining table...', 'info');
            
            const transactionSuccess = await syncBalanceWithDashboard({
                amount: -buyIn,
                type: "poker_buyin",
                description: `Poker buy-in at ${playerName} table`
            });
            
            if (!transactionSuccess) {
                showToast('Failed to join table - transaction error', 'error');
                return;
            }
            
            // Initialize game with buy-in as starting stack
            await initializeGame();
            showToast('Welcome to the table!', 'success');
        }

        // ===== INITIALIZE GAME =====
        async function initializeGame() {
            // Generate game ID
            gameState.gameId = 'poker_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            gameState.playerId = gameState.currentUser.uid;
            gameState.isPlaying = true;
            
            // Initialize 4 AI players with random names
            const usedNames = new Set([gameState.playerProfile.name]);
            gameState.players = [
                {
                    id: gameState.playerId,
                    name: gameState.playerProfile.name,
                    stack: gameState.playerProfile.buyIn,
                    isAI: false,
                    position: 0,
                    cards: [],
                    isActive: true,
                    isFolded: false,
                    currentBet: 0,
                    hasActed: false
                }
            ];

            for (let i = 1; i < 5; i++) {
                let aiName;
                do {
                    aiName = playerNames[Math.floor(Math.random() * playerNames.length)];
                } while (usedNames.has(aiName));
                
                usedNames.add(aiName);
                
                const aiStack = Math.floor(Math.random() * (5000 - 100 + 1)) + 100;
                gameState.players.push({
                    id: `ai_${i}`,
                    name: aiName,
                    stack: aiStack,
                    isAI: true,
                    position: i,
                    cards: [],
                    isActive: true,
                    isFolded: false,
                    currentBet: 0,
                    hasActed: false,
                    aiStyle: Math.random() > 0.5 ? 'aggressive' : 'conservative'
                });
            }

            // Update UI
            updatePlayerDisplays();
            document.getElementById('actionControls').style.display = 'grid';
            
            // Start first hand
            setTimeout(() => {
                startNewHand();
            }, 1000);
        }

        // ===== UPDATE PLAYER DISPLAYS =====
        function updatePlayerDisplays() {
            gameState.players.forEach((player, index) => {
                const seat = document.getElementById(`seat${index}`);
                const nameElement = document.getElementById(`seat${index}Name`);
                const stackElement = document.getElementById(`seat${index}Stack`);
                
                if (seat && nameElement && stackElement) {
                    nameElement.textContent = player.name;
                    stackElement.textContent = `$${player.stack}`;
                    
                    // Update seat styling
                    seat.classList.remove('active', 'dealer');
                    if (gameState.currentPlayer === player.id) {
                        seat.classList.add('active');
                    }
                    if (index === gameState.dealerPosition) {
                        seat.classList.add('dealer');
                    }
                    
                    // Update action display
                    const actionElement = document.getElementById(`seat${index}Actions`);
                    if (actionElement) {
                        if (player.isFolded) {
                            actionElement.innerHTML = '<span style="color: var(--danger);">Folded</span>';
                        } else if (player.currentBet > 0) {
                            actionElement.innerHTML = `<span style="color: var(--warning);">Bet: $${player.currentBet}</span>`;
                        } else {
                            actionElement.innerHTML = '';
                        }
                    }
                }
            });
        }

        // ===== START NEW HAND =====
        function startNewHand() {
            gameState.deck = createDeck();
            shuffleDeck(gameState.deck);
            gameState.communityCards = [];
            gameState.pot = 0;
            
            // Reset player states
            gameState.players.forEach(player => {
                player.cards = [];
                player.isFolded = false;
                player.currentBet = 0;
                player.hasActed = false;
                player.isAllIn = false;
            });
            
            // Deal hole cards
            dealHoleCards();
            
            // Update dealer position
            gameState.dealerPosition = (gameState.dealerPosition + 1) % 5;
            
            // Determine first player (small blind)
            const smallBlindPos = (gameState.dealerPosition + 1) % 5;
            gameState.currentPlayer = gameState.players[smallBlindPos].id;
            
            // Post blinds
            postBlinds();
            
            // Update UI
            updateCommunityCards();
            updatePlayerDisplays();
            document.getElementById('potDisplay').textContent = `Pot: $${gameState.pot}`;
            
            // Start betting round
            startBettingRound('preflop');
        }

        // ===== DECK FUNCTIONS =====
        function createDeck() {
            const deck = [];
            for (const suit of suits) {
                for (const rank of ranks) {
                    deck.push({
                        rank,
                        suit,
                        color: suit === '♥' || suit === '♦' ? 'red' : 'black'
                    });
                }
            }
            return deck;
        }

        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        // ===== DEAL CARDS =====
        function dealHoleCards() {
            // Deal two cards to each player
            for (let i = 0; i < 2; i++) {
                gameState.players.forEach(player => {
                    if (player.isActive && !player.isFolded) {
                        const card = gameState.deck.pop();
                        player.cards.push(card);
                        
                        // Update card display (face down for other players)
                        if (player.id === gameState.playerId) {
                            updatePlayerCards(player);
                        }
                    }
                });
            }
        }

        function updatePlayerCards(player) {
            if (player.id === gameState.playerId) {
                const seat = document.getElementById('seat0');
                const cardContainer = seat.querySelector('.player-cards');
                cardContainer.innerHTML = '';
                
                player.cards.forEach(card => {
                    const cardElement = createCardElement(card);
                    cardElement.classList.add('card-deal');
                    cardContainer.appendChild(cardElement);
                });
            }
        }

        function createCardElement(card) {
            const div = document.createElement('div');
            div.className = `card ${card.color}`;
            div.innerHTML = `
                <div class="card-rank">${card.rank}</div>
                <div class="card-suit">${card.suit}</div>
            `;
            return div;
        }

        // ===== BLINDS =====
        function postBlinds() {
            const smallBlindPos = (gameState.dealerPosition + 1) % 5;
            const bigBlindPos = (gameState.dealerPosition + 2) % 5;
            
            const smallBlind = 1;
            const bigBlind = 2;
            
            // Post small blind
            const sbPlayer = gameState.players[smallBlindPos];
            sbPlayer.currentBet = Math.min(smallBlind, sbPlayer.stack);
            sbPlayer.stack -= sbPlayer.currentBet;
            gameState.pot += sbPlayer.currentBet;
            
            // Post big blind
            const bbPlayer = gameState.players[bigBlindPos];
            bbPlayer.currentBet = Math.min(bigBlind, bbPlayer.stack);
            bbPlayer.stack -= bbPlayer.currentBet;
            gameState.pot += bbPlayer.currentBet;
            
            showToast(`${sbPlayer.name} posts small blind $${smallBlind}`, 'info');
            showToast(`${bbPlayer.name} posts big blind $${bigBlind}`, 'info');
        }

        // ===== BETTING ROUNDS =====
        function startBettingRound(round) {
            showToast(`${round.charAt(0).toUpperCase() + round.slice(1)} betting round`, 'info');
            
            // Reset action flags
            gameState.players.forEach(player => {
                player.hasActed = false;
            });
            
            // Start with player after big blind
            const startPos = (gameState.dealerPosition + 3) % 5;
            gameState.currentPlayer = gameState.players[startPos].id;
            
            updatePlayerDisplays();
            enablePlayerActions();
            
            // Start AI actions
            startAIActions();
        }

        // ===== PLAYER ACTIONS =====
        function enablePlayerActions() {
            const currentPlayer = gameState.players.find(p => p.id === gameState.currentPlayer);
            
            if (currentPlayer && currentPlayer.id === gameState.playerId) {
                // It's the human player's turn
                const callAmount = getCallAmount();
                
                document.getElementById('btnFold').disabled = false;
                document.getElementById('btnCheck').disabled = callAmount > 0;
                document.getElementById('btnCall').disabled = callAmount === 0;
                document.getElementById('btnCall').innerHTML = `<i class="fas fa-handshake"></i> Call $${callAmount}`;
                document.getElementById('btnRaise').disabled = false;
                document.getElementById('btnAllIn').disabled = false;
                
                // Set minimum raise
                const minRaise = Math.max(getCallAmount() * 2, 4);
                document.getElementById('betAmount').value = minRaise;
                document.getElementById('betAmount').min = minRaise;
            } else {
                // Disable buttons for AI turn
                disablePlayerActions();
            }
        }

        function disablePlayerActions() {
            document.getElementById('btnFold').disabled = true;
            document.getElementById('btnCheck').disabled = true;
            document.getElementById('btnCall').disabled = true;
            document.getElementById('btnRaise').disabled = true;
            document.getElementById('btnAllIn').disabled = true;
        }

        function playerAction(action) {
            if (gameState.currentPlayer !== gameState.playerId) return;
            
            const player = gameState.players.find(p => p.id === gameState.playerId);
            if (!player || player.isFolded) return;
            
            let amount = 0;
            
            switch (action) {
                case 'fold':
                    player.isFolded = true;
                    showToast(`${player.name} folds`, 'info');
                    break;
                    
                case 'check':
                    // Can only check if no bet to call
                    if (getCallAmount() > 0) return;
                    showToast(`${player.name} checks`, 'info');
                    break;
                    
                case 'call':
                    amount = getCallAmount();
                    if (amount === 0) return;
                    
                    const callAmount = Math.min(amount, player.stack);
                    player.currentBet += callAmount;
                    player.stack -= callAmount;
                    gameState.pot += callAmount;
                    
                    showToast(`${player.name} calls $${callAmount}`, 'info');
                    break;
                    
                case 'raise':
                    amount = parseInt(document.getElementById('betAmount').value);
                    if (isNaN(amount) || amount < getCallAmount() * 2) {
                        showToast(`Minimum raise is $${getCallAmount() * 2}`, 'warning');
                        return;
                    }
                    if (amount > player.stack) {
                        amount = player.stack;
                    }
                    
                    const raiseAmount = Math.max(amount, getCallAmount() * 2);
                    player.currentBet += raiseAmount;
                    player.stack -= raiseAmount;
                    gameState.pot += raiseAmount;
                    
                    showToast(`${player.name} raises to $${player.currentBet}`, 'info');
                    break;
                    
                case 'allin':
                    amount = player.stack;
                    player.currentBet += amount;
                    player.stack = 0;
                    gameState.pot += amount;
                    player.isAllIn = true;
                    
                    showToast(`${player.name} goes all in for $${amount}!`, 'warning');
                    break;
            }
            
            player.hasActed = true;
            updatePlayerDisplays();
            document.getElementById('potDisplay').textContent = `Pot: $${gameState.pot}`;
            
            // Move to next player
            advanceToNextPlayer();
        }

        function getCallAmount() {
            const currentPlayer = gameState.players.find(p => p.id === gameState.currentPlayer);
            if (!currentPlayer) return 0;
            
            const maxBet = Math.max(...gameState.players.map(p => p.currentBet));
            return Math.max(0, maxBet - currentPlayer.currentBet);
        }

        // ===== AI ACTIONS =====
        function startAIActions() {
            const interval = setInterval(() => {
                const currentPlayer = gameState.players.find(p => p.id === gameState.currentPlayer);
                
                if (!currentPlayer) {
                    clearInterval(interval);
                    return;
                }
                
                if (currentPlayer.id === gameState.playerId) {
                    clearInterval(interval);
                    return;
                }
                
                if (currentPlayer.isAI && !currentPlayer.hasActed && !currentPlayer.isFolded) {
                    makeAIAction(currentPlayer);
                }
                
                // Check if betting round is complete
                if (isBettingRoundComplete()) {
                    clearInterval(interval);
                    advanceGame();
                }
            }, 2000);
        }

        function makeAIAction(player) {
            const callAmount = getCallAmount();
            const random = Math.random();
            
            // Simple AI logic based on play style
            let action;
            
            if (player.isAllIn) {
                action = 'check';
            } else if (player.aiStyle === 'aggressive') {
                if (random < 0.3) {
                    action = 'fold';
                } else if (random < 0.6) {
                    action = 'call';
                } else {
                    action = 'raise';
                }
            } else { // conservative
                if (random < 0.5) {
                    action = 'fold';
                } else if (random < 0.8) {
                    action = 'call';
                } else {
                    action = 'check';
                }
            }
            
            // Adjust based on call amount
            if (action === 'call' && callAmount > player.stack * 0.5) {
                action = 'fold';
            }
            
            if (action === 'raise') {
                const raiseAmount = Math.min(
                    Math.max(callAmount * 2, Math.floor(player.stack * 0.3)),
                    player.stack
                );
                
                player.currentBet += raiseAmount;
                player.stack -= raiseAmount;
                gameState.pot += raiseAmount;
                
                showToast(`${player.name} raises to $${player.currentBet}`, 'info');
            } else if (action === 'call' && callAmount > 0) {
                const actualCall = Math.min(callAmount, player.stack);
                player.currentBet += actualCall;
                player.stack -= actualCall;
                gameState.pot += actualCall;
                
                showToast(`${player.name} calls $${actualCall}`, 'info');
            } else if (action === 'fold') {
                player.isFolded = true;
                showToast(`${player.name} folds`, 'info');
            } else {
                showToast(`${player.name} checks`, 'info');
            }
            
            player.hasActed = true;
            updatePlayerDisplays();
            advanceToNextPlayer();
        }

        // ===== GAME PROGRESSION =====
        function advanceToNextPlayer() {
            const currentIndex = gameState.players.findIndex(p => p.id === gameState.currentPlayer);
            let nextIndex = (currentIndex + 1) % 5;
            let attempts = 0;
            
            while (attempts < 5) {
                const nextPlayer = gameState.players[nextIndex];
                
                if (nextPlayer.isActive && !nextPlayer.isFolded && !nextPlayer.isAllIn) {
                    gameState.currentPlayer = nextPlayer.id;
                    updatePlayerDisplays();
                    enablePlayerActions();
                    return;
                }
                
                nextIndex = (nextIndex + 1) % 5;
                attempts++;
            }
            
            // If we get here, betting round might be complete
            if (isBettingRoundComplete()) {
                advanceGame();
            }
        }

        function isBettingRoundComplete() {
            const activePlayers = gameState.players.filter(p => 
                p.isActive && !p.isFolded && !p.isAllIn
            );
            
            if (activePlayers.length <= 1) return true;
            
            const maxBet = Math.max(...gameState.players.map(p => p.currentBet));
            const allActed = activePlayers.every(p => p.hasActed || p.isAllIn);
            const allEqualized = activePlayers.every(p => 
                p.currentBet === maxBet || p.isAllIn || p.stack === 0
            );
            
            return allActed && allEqualized;
        }

        function advanceGame() {
            const currentRound = getCurrentRound();
            
            switch (currentRound) {
                case 'preflop':
                    dealCommunityCards(3); // Flop
                    startBettingRound('flop');
                    break;
                    
                case 'flop':
                    dealCommunityCards(1); // Turn
                    startBettingRound('turn');
                    break;
                    
                case 'turn':
                    dealCommunityCards(1); // River
                    startBettingRound('river');
                    break;
                    
                case 'river':
                    evaluateHands();
                    break;
            }
        }

        function getCurrentRound() {
            const cardCount = gameState.communityCards.length;
            if (cardCount === 0) return 'preflop';
            if (cardCount === 3) return 'flop';
            if (cardCount === 4) return 'turn';
            return 'river';
        }

        function dealCommunityCards(count) {
            for (let i = 0; i < count; i++) {
                const card = gameState.deck.pop();
                gameState.communityCards.push(card);
            }
            updateCommunityCards();
        }

        function updateCommunityCards() {
            const container = document.getElementById('communityCards');
            container.innerHTML = '';
            
            gameState.communityCards.forEach(card => {
                const cardElement = createCardElement(card);
                cardElement.classList.add('card-deal');
                container.appendChild(cardElement);
            });
            
            // Add placeholders for remaining cards
            const remaining = 5 - gameState.communityCards.length;
            for (let i = 0; i < remaining; i++) {
                const placeholder = document.createElement('div');
                placeholder.className = 'card back';
                placeholder.innerHTML = '?';
                container.appendChild(placeholder);
            }
        }

        // ===== HAND EVALUATION =====
        function evaluateHands() {
            // Get active players
            const activePlayers = gameState.players.filter(p => !p.isFolded && p.isActive);
            
            if (activePlayers.length === 0) return;
            
            // For demo, 10% win rate for human player
            const humanWins = Math.random() < 0.10;
            
            let winners;
            
            if (humanWins) {
                // Human wins
                winners = [gameState.players.find(p => p.id === gameState.playerId)];
            } else {
                // Random AI wins
                const aiPlayers = activePlayers.filter(p => p.isAI);
                winners = [aiPlayers[Math.floor(Math.random() * aiPlayers.length)]];
            }
            
            // Distribute pot
            const winAmount = gameState.pot;
            winners.forEach(winner => {
                winner.stack += winAmount;
                showToast(`${winner.name} wins $${winAmount}!`, 'success');
                
                // Update stats for human player
                if (winner.id === gameState.playerId) {
                    gameState.gameStats.totalWon += winAmount;
                    gameState.gameStats.totalHands++;
                    
                    // Record win in winners list
                    recordWin(winner.name, winAmount);
                    
                    // Animate win
                    document.getElementById('potDisplay').classList.add('win-animation');
                    setTimeout(() => {
                        document.getElementById('potDisplay').classList.remove('win-animation');
                    }, 2000);
                    
                    // Sync winnings to main balance
                    syncBalanceWithDashboard({
                        amount: winAmount,
                        type: "poker_win",
                        description: `Won poker hand of $${winAmount}`
                    });
                }
            });
            
            // Update game stats
            updateGameStats();
            
            // Show showdown (reveal all cards)
            revealAllCards();
            
            // Start next hand after delay
            setTimeout(() => {
                gameState.gameStats.totalHands++;
                startNewHand();
            }, 5000);
        }

        function revealAllCards() {
            gameState.players.forEach((player, index) => {
                if (!player.isFolded) {
                    const seat = document.getElementById(`seat${index}`);
                    const cardContainer = seat.querySelector('.player-cards');
                    cardContainer.innerHTML = '';
                    
                    player.cards.forEach(card => {
                        const cardElement = createCardElement(card);
                        cardContainer.appendChild(cardElement);
                    });
                }
            });
        }

        // ===== WINNERS TRACKING =====
        function recordWin(playerName, amount) {
            const winRecord = {
                player: playerName,
                amount: amount,
                timestamp: new Date()
            };
            
            gameState.winners.unshift(winRecord);
            if (gameState.winners.length > 10) {
                gameState.winners.pop();
            }
            
            updateWinnersDisplay();
            
            // Save to Firebase
            saveWinToFirebase(playerName, amount);
        }

        function updateWinnersDisplay() {
            const container = document.getElementById('winnersList');
            container.innerHTML = '';
            
            gameState.winners.forEach(winner => {
                const item = document.createElement('div');
                item.className = 'winner-item';
                item.innerHTML = `
                    <span class="winner-name">${winner.player}</span>
                    <span class="winner-amount">$${winner.amount}</span>
                `;
                container.appendChild(item);
            });
        }

        async function loadRecentWinners() {
            try {
                const snapshot = await db.collection('poker_wins')
                    .orderBy('timestamp', 'desc')
                    .limit(10)
                    .get();
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    gameState.winners.push({
                        player: data.player,
                        amount: data.amount,
                        timestamp: data.timestamp.toDate()
                    });
                });
                
                updateWinnersDisplay();
            } catch (error) {
                console.error('Error loading winners:', error);
            }
        }

        async function saveWinToFirebase(playerName, amount) {
            try {
                await db.collection('poker_wins').add({
                    player: playerName,
                    amount: amount,
                    timestamp: new Date(),
                    gameId: gameState.gameId,
                    userId: gameState.currentUser.uid
                });
            } catch (error) {
                console.error('Error saving win:', error);
            }
        }

        // ===== GAME STATS =====
        function updateGameStats() {
            const winRate = gameState.gameStats.totalHands > 0 
                ? Math.round((gameState.gameStats.totalWon / gameState.gameStats.totalHands) * 100)
                : 0;
            
            document.getElementById('winRate').textContent = `${winRate}%`;
            document.getElementById('totalHands').textContent = gameState.gameStats.totalHands;
            document.getElementById('totalWon').textContent = `$${gameState.gameStats.totalWon}`;
            document.getElementById('totalLost').textContent = `$${gameState.gameStats.totalLost}`;
        }

        // ===== ANIMATIONS =====
        function animateChip(element) {
            element.classList.add('chip-animation');
            setTimeout(() => {
                element.classList.remove('chip-animation');
            }, 1000);
        }

        // ===== TOAST NOTIFICATIONS =====
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (container.contains(toast)) {
                        container.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // ===== ECONOMY BALANCE (90% LOSE, 10% WIN) =====
        function calculateHouseEdge() {
            // This ensures 90% lose rate overall
            // The actual win chance per hand is already 10% for human player
            // Additional house edge comes from:
            // 1. 5% rake on pots over $10
            // 2. Blinds system
            // 3. AI advantage in decision making
            
            const totalRake = gameState.pot * 0.05;
            return Math.min(totalRake, 10); // Max $10 rake per hand
        }

        // ===== LEAVE GAME =====
        async function leaveGame() {
            if (gameState.isPlaying) {
                // Cash out player's stack
                const player = gameState.players.find(p => p.id === gameState.playerId);
                if (player && player.stack > 0) {
                    const cashOutAmount = player.stack;
                    
                    await syncBalanceWithDashboard({
                        amount: cashOutAmount,
                        type: "poker_cashout",
                        description: `Cashed out poker balance of $${cashOutAmount}`
                    });
                    
                    showToast(`Cashed out $${cashOutAmount}`, 'success');
                }
                
                gameState.isPlaying = false;
            }
            
            // Redirect to home
            window.location.href = "https://xcrazybet.github.io/millioner";
        }

        // Add leave game on page unload
        window.addEventListener('beforeunload', (e) => {
            if (gameState.isPlaying) {
                // Optional: Auto-cash out on leave
                // leaveGame();
            }
        });

        // Add keyboard shortcut for leaving (Ctrl+H for home)
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'h') {
                e.preventDefault();
                leaveGame();
            }
        });
    </script>
</body>
</html>
