<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚ô†Ô∏è Professional Poker - XCrazyBet</title>
    
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Roboto+Mono:wght@300;400&display=swap" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>

    <style>
        :root {
            --primary: #ff4081;
            --primary-dark: #d81b60;
            --secondary: #2196f3;
            --success: #4caf50;
            --danger: #ff5252;
            --warning: #ff9800;
            --info: #17a2b8;
            --dark-bg: #0a0a1a;
            --medium-bg: #121230;
            --light-bg: #1a1a3a;
            --table-green: #0a5c36;
            --table-border: #8b4513;
            --text: #ffffff;
            --text-secondary: #b0b0b0;
            --chip-1: #ff4081;
            --chip-5: #2196f3;
            --chip-10: #4caf50;
            --chip-25: #ff9800;
            --chip-100: #9c27b0;
            --chip-500: #f44336;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--dark-bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 64, 129, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 80% 20%, rgba(33, 150, 243, 0.1) 0%, transparent 20%);
            padding-bottom: 80px; /* Space for mobile controls */
        }

        /* Compact Header for Mobile */
        .header {
            background: rgba(10, 10, 26, 0.98);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            height: 60px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
        }

        .logo {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 1;
            min-width: 0;
        }

        .logo i {
            font-size: 20px;
            flex-shrink: 0;
        }

        .logo span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .nav-links {
            display: flex;
            gap: 8px;
            flex-wrap: nowrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding: 2px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .nav-links::-webkit-scrollbar {
            display: none;
        }

        .nav-btn {
            padding: 6px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--text);
            text-decoration: none;
            font-weight: 500;
            font-size: 12px;
            transition: all 0.2s;
            border: 1px solid transparent;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .nav-btn:hover {
            background: var(--primary);
            transform: translateY(-1px);
        }

        .nav-btn.active {
            background: var(--primary);
            border-color: var(--text);
        }

        .balance-display {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text);
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }

        /* Main Container - Responsive */
        .container {
            display: flex;
            flex-direction: column;
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
            gap: 10px;
            min-height: calc(100vh - 60px);
        }

        /* For tablets and larger */
        @media (min-width: 768px) {
            .container {
                flex-direction: row;
                padding: 15px;
                gap: 15px;
                max-width: 1400px;
            }
        }

        /* Sidebar - Hidden on Mobile, Visible on Desktop */
        .sidebar {
            background: rgba(18, 18, 48, 0.95);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--primary);
            backdrop-filter: blur(5px);
            display: none; /* Hidden on mobile by default */
            flex-direction: column;
            gap: 20px;
            max-height: calc(100vh - 80px);
            overflow-y: auto;
        }

        @media (min-width: 768px) {
            .sidebar {
                display: flex;
                flex: 0 0 280px;
            }
        }

        /* Mobile Sidebar Overlay */
        .sidebar-overlay {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 999;
            display: none;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .sidebar-overlay.active {
            display: flex;
        }

        .sidebar-section {
            margin-bottom: 20px;
        }

        .sidebar-section:last-child {
            margin-bottom: 0;
        }

        .sidebar h3 {
            color: var(--primary);
            margin-bottom: 12px;
            font-size: 16px;
            border-bottom: 1px solid var(--primary);
            padding-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Player Info Form */
        .player-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .form-group label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .form-input {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--light-bg);
            border-radius: 6px;
            color: var(--text);
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255, 64, 129, 0.2);
        }

        .select-wrapper {
            position: relative;
        }

        .select-wrapper select {
            appearance: none;
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--light-bg);
            border-radius: 6px;
            color: var(--text);
            cursor: pointer;
        }

        .select-wrapper::after {
            content: '‚ñº';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 10px;
            pointer-events: none;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 0; /* Important for flexbox overflow */
        }

        @media (min-width: 768px) {
            .main-content {
                gap: 15px;
            }
        }

        /* Poker Table Container - Responsive */
        .poker-table-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio for mobile */
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .poker-table-container {
                padding-top: 0;
                height: 500px;
            }
        }

        @media (min-width: 1024px) {
            .poker-table-container {
                height: 600px;
            }
        }

        .poker-table {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            background: radial-gradient(circle at center, var(--table-green) 0%, #05422a 70%, #032017 100%);
            border-radius: 50%;
            border: 8px solid var(--table-border);
            box-shadow: 
                0 0 0 4px #654321,
                inset 0 0 30px rgba(0, 0, 0, 0.7),
                0 8px 20px rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .poker-table {
                top: 20px;
                left: 20px;
                right: 20px;
                bottom: 20px;
                border-width: 12px;
            }
        }

        .table-felt {
            position: absolute;
            width: 80%;
            height: 80%;
            background: rgba(10, 92, 54, 0.6);
            border-radius: 50%;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8);
        }

        .table-center {
            position: absolute;
            width: 40%;
            height: 40%;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            z-index: 2;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 10px;
        }

        @media (min-width: 768px) {
            .table-center {
                width: 35%;
                height: 35%;
                gap: 8px;
            }
        }

        .pot-display {
            font-size: 16px;
            font-weight: 700;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
            padding: 4px 10px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 8px;
            border: 1px solid gold;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        @media (min-width: 768px) {
            .pot-display {
                font-size: 20px;
                padding: 5px 15px;
            }
        }

        .round-display {
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 500;
            text-align: center;
        }

        @media (min-width: 768px) {
            .round-display {
                font-size: 14px;
            }
        }

        .community-cards {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 5px;
        }

        @media (min-width: 768px) {
            .community-cards {
                gap: 8px;
            }
        }

        /* Player Seats - Responsive Positioning */
        .player-seat {
            position: absolute;
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.9), rgba(30, 30, 50, 0.9));
            border-radius: 8px;
            border: 2px solid var(--primary);
            padding: 8px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.5);
            z-index: 10;
            min-width: 0;
            max-width: 120px;
            width: auto;
        }

        /* Mobile seat sizes */
        .player-seat {
            width: 90px;
            height: 110px;
        }

        @media (max-width: 480px) {
            .player-seat {
                width: 80px;
                height: 100px;
                padding: 6px;
            }
        }

        @media (min-width: 768px) {
            .player-seat {
                width: 120px;
                height: 140px;
                padding: 12px;
            }
        }

        @media (min-width: 1024px) {
            .player-seat {
                width: 140px;
                height: 160px;
                padding: 15px;
            }
        }

        /* Seat Positions - Responsive */
        /* Seat 0 (You - Bottom Center) */
        #seat0 {
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
        }

        @media (min-width: 768px) {
            #seat0 {
                bottom: 20px;
            }
        }

        /* Seat 1 (Right Center) */
        #seat1 {
            top: 50%;
            right: 5px;
            transform: translateY(-50%);
        }

        @media (min-width: 768px) {
            #seat1 {
                right: 20px;
            }
        }

        /* Seat 2 (Top Center) */
        #seat2 {
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
        }

        @media (min-width: 768px) {
            #seat2 {
                top: 20px;
            }
        }

        /* Seat 3 (Left Center) */
        #seat3 {
            top: 50%;
            left: 5px;
            transform: translateY(-50%);
        }

        @media (min-width: 768px) {
            #seat3 {
                left: 20px;
            }
        }

        /* Seat 4 (Bottom Right - For 5 players) */
        #seat4 {
            bottom: 60px;
            right: 60px;
        }

        @media (max-width: 767px) {
            #seat4 {
                bottom: 40px;
                right: 40px;
            }
        }

        @media (max-width: 480px) {
            #seat4 {
                bottom: 30px;
                right: 30px;
            }
        }

        /* Hide seat 4 on very small screens */
        @media (max-width: 360px) {
            #seat4 {
                display: none;
            }
        }

        .player-seat::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 10px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .player-seat.active::before {
            opacity: 1;
        }

        .player-seat.active {
            transform: translate(var(--tx, -50%), var(--ty, 0)) scale(1.1);
            z-index: 20;
            box-shadow: 0 0 20px rgba(255, 64, 129, 0.6);
        }

        .player-seat.dealer {
            border-color: var(--secondary);
        }

        .player-seat.dealer::after {
            content: 'D';
            position: absolute;
            top: -8px;
            right: -8px;
            width: 16px;
            height: 16px;
            background: var(--secondary);
            border-radius: 50%;
            color: white;
            font-size: 10px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (min-width: 768px) {
            .player-seat.dealer::after {
                top: -10px;
                right: -10px;
                width: 20px;
                height: 20px;
                font-size: 12px;
            }
        }

        .player-seat.folded {
            opacity: 0.5;
            filter: grayscale(0.7);
        }

        .player-seat.allin {
            border-color: var(--warning);
            animation: pulse 2s infinite;
        }

        .player-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 0;
        }

        .player-name {
            font-weight: 600;
            font-size: 11px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--text);
        }

        @media (min-width: 768px) {
            .player-name {
                font-size: 13px;
            }
        }

        .player-stack {
            color: var(--success);
            font-size: 12px;
            font-weight: 700;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @media (min-width: 768px) {
            .player-stack {
                font-size: 14px;
            }
        }

        .player-cards {
            display: flex;
            justify-content: center;
            gap: 3px;
            margin: 4px 0;
        }

        @media (min-width: 768px) {
            .player-cards {
                gap: 5px;
                margin: 6px 0;
            }
        }

        .player-status {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @media (min-width: 768px) {
            .player-status {
                font-size: 11px;
                padding: 3px 8px;
            }
        }

        .player-status.folded {
            background: var(--danger);
            color: white;
        }

        .player-status.allin {
            background: var(--warning);
            color: black;
        }

        .player-status.bet {
            background: var(--info);
            color: white;
        }

        /* Card Styles - Responsive */
        .card {
            background: white;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: black;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
            position: relative;
            cursor: pointer;
            user-select: none;
            transform-style: preserve-3d;
            transition: transform 0.3s, box-shadow 0.3s;
            flex-shrink: 0;
        }

        /* Mobile card sizes */
        .card {
            width: 25px;
            height: 35px;
            font-size: 12px;
        }

        @media (min-width: 480px) {
            .card {
                width: 30px;
                height: 45px;
                font-size: 14px;
            }
        }

        @media (min-width: 768px) {
            .card {
                width: 40px;
                height: 60px;
                font-size: 16px;
            }
        }

        @media (min-width: 1024px) {
            .card {
                width: 45px;
                height: 65px;
                font-size: 18px;
            }
        }

        .card.red {
            color: #d50000;
        }

        .card.black {
            color: #000;
        }

        .card.back {
            background: linear-gradient(135deg, var(--primary-dark), var(--secondary));
            color: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card.back::before {
            content: '‚ô†Ô∏è';
            position: absolute;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }

        @media (min-width: 768px) {
            .card.back::before {
                font-size: 18px;
            }
        }

        @media (min-width: 1024px) {
            .card.back::before {
                font-size: 24px;
            }
        }

        .card-corner {
            position: absolute;
            font-size: 8px;
            font-weight: bold;
        }

        @media (min-width: 768px) {
            .card-corner {
                font-size: 10px;
            }
        }

        @media (min-width: 1024px) {
            .card-corner {
                font-size: 12px;
            }
        }

        .card-corner-top {
            top: 2px;
            left: 2px;
        }

        .card-corner-bottom {
            bottom: 2px;
            right: 2px;
            transform: rotate(180deg);
        }

        .card-center {
            font-size: 14px;
            margin-top: 3px;
        }

        @media (min-width: 768px) {
            .card-center {
                font-size: 18px;
                margin-top: 5px;
            }
        }

        @media (min-width: 1024px) {
            .card-center {
                font-size: 24px;
            }
        }

        /* Mobile Action Controls - Fixed at bottom */
        .mobile-action-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.95);
            border-top: 2px solid var(--primary);
            padding: 10px;
            z-index: 1000;
            display: none;
            backdrop-filter: blur(10px);
        }

        .mobile-action-controls.active {
            display: block;
        }

        .mobile-action-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }

        .mobile-bet-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .mobile-bet-input {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--primary);
            border-radius: 6px;
            color: var(--text);
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            min-width: 0;
        }

        .mobile-chip-selector {
            display: flex;
            gap: 6px;
            overflow-x: auto;
            padding: 5px 0;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .mobile-chip-selector::-webkit-scrollbar {
            display: none;
        }

        .mobile-chip {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid white;
            font-size: 12px;
            position: relative;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }

        /* Desktop Action Controls */
        .desktop-action-controls {
            background: rgba(0, 0, 0, 0.85);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--primary);
            display: none;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            backdrop-filter: blur(10px);
        }

        @media (min-width: 768px) {
            .desktop-action-controls.active {
                display: grid;
            }
        }

        .action-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        @media (min-width: 768px) {
            .action-btn {
                padding: 14px;
                font-size: 14px;
                gap: 8px;
            }
        }

        .action-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none !important;
        }

        .action-btn:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-fold {
            background: linear-gradient(135deg, var(--danger), #c62828);
            color: white;
        }

        .btn-check {
            background: linear-gradient(135deg, var(--text-secondary), #78909c);
            color: black;
        }

        .btn-call {
            background: linear-gradient(135deg, var(--secondary), #1565c0);
            color: white;
        }

        .btn-raise {
            background: linear-gradient(135deg, var(--warning), #ef6c00);
            color: white;
        }

        .btn-allin {
            background: linear-gradient(135deg, var(--primary), #ad1457);
            color: white;
        }

        /* Game Info - Hidden on mobile, shown on desktop */
        .game-info {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--secondary);
            display: none;
        }

        @media (min-width: 768px) {
            .game-info {
                display: block;
            }
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        @media (min-width: 1024px) {
            .game-stats {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .stat-box {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: all 0.2s;
        }

        .stat-box:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary);
        }

        @media (min-width: 768px) {
            .stat-label {
                font-size: 12px;
            }
            
            .stat-value {
                font-size: 20px;
            }
        }

        /* Mobile Game Stats Button */
        .mobile-stats-btn {
            position: fixed;
            bottom: 80px;
            right: 15px;
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            display: none;
        }

        @media (max-width: 767px) {
            .mobile-stats-btn {
                display: flex;
            }
        }

        /* Game History */
        .game-history {
            background: rgba(0, 0, 0, 0.9);
            border-radius: 12px;
            padding: 15px;
            margin-top: 10px;
            border: 1px solid var(--primary);
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        @media (min-width: 768px) {
            .game-history {
                display: block;
                max-height: 300px;
                margin-top: 15px;
            }
        }

        .history-title {
            color: var(--primary);
            font-size: 14px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (min-width: 768px) {
            .history-title {
                font-size: 16px;
            }
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            font-size: 12px;
            transition: all 0.2s;
        }

        @media (min-width: 768px) {
            .history-item {
                font-size: 13px;
                padding: 10px 15px;
            }
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .history-item.win {
            border-left: 4px solid var(--success);
        }

        .history-item.loss {
            border-left: 4px solid var(--danger);
        }

        .history-time {
            color: var(--text-secondary);
            font-size: 10px;
            white-space: nowrap;
        }

        @media (min-width: 768px) {
            .history-time {
                font-size: 11px;
            }
        }

        .history-amount {
            font-weight: 600;
            white-space: nowrap;
        }

        .history-amount.win {
            color: var(--success);
        }

        .history-amount.loss {
            color: var(--danger);
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            top: 70px;
            right: 10px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            z-index: 1000;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        @media (min-width: 768px) {
            .connection-status {
                top: 20px;
                right: 20px;
                font-size: 12px;
                padding: 8px 15px;
            }
        }

        .status-connected {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .status-disconnected {
            background: rgba(255, 82, 82, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        /* Game State Overlay */
        .game-state-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            border-radius: inherit;
            backdrop-filter: blur(5px);
        }

        .state-message {
            background: rgba(0, 0, 0, 0.95);
            padding: 20px 30px;
            border-radius: 12px;
            border: 2px solid var(--primary);
            text-align: center;
            animation: pulse 2s infinite;
            max-width: 90%;
            margin: 20px;
        }

        .state-message h3 {
            color: var(--primary);
            font-size: 18px;
            margin-bottom: 10px;
        }

        .state-message p {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 15px;
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes chipThrow {
            0% { transform: translateY(0) rotate(0deg) scale(1); }
            50% { transform: translateY(-40px) rotate(180deg) scale(1.2); }
            100% { transform: translateY(0) rotate(360deg) scale(1); }
        }

        @keyframes cardDeal {
            0% { 
                transform: translateY(-60px) rotateY(0deg) scale(0.8); 
                opacity: 0; 
            }
            50% { 
                transform: translateY(-30px) rotateY(180deg) scale(1.1); 
            }
            100% { 
                transform: translateY(0) rotateY(360deg) scale(1); 
                opacity: 1; 
            }
        }

        @keyframes winGlow {
            0%, 100% { 
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); 
            }
            50% { 
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 45px rgba(255, 215, 0, 0.6); 
            }
        }

        @keyframes lossFade {
            from { 
                background: rgba(255, 82, 82, 0.3); 
            }
            to { 
                background: transparent; 
            }
        }

        .chip-animation {
            animation: chipThrow 0.8s ease-out;
        }

        .card-deal {
            animation: cardDeal 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .win-glow {
            animation: winGlow 1s ease-in-out infinite;
        }

        .loss-fade {
            animation: lossFade 2s ease-out;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 70px;
            left: 10px;
            right: 10px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 8px;
            pointer-events: none;
        }

        @media (min-width: 768px) {
            .toast-container {
                top: 20px;
                right: 20px;
                left: auto;
                max-width: 350px;
            }
        }

        .toast {
            padding: 12px 16px;
            border-radius: 8px;
            background: rgba(26, 26, 46, 0.95);
            border-left: 4px solid var(--primary);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            transform: translateX(-100%);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 10px;
            pointer-events: auto;
            max-width: 100%;
        }

        @media (min-width: 768px) {
            .toast {
                transform: translateX(100%);
                max-width: 350px;
            }
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--danger); }
        .toast.warning { border-color: var(--warning); }
        .toast.info { border-color: var(--info); }

        .toast i {
            font-size: 16px;
            flex-shrink: 0;
        }

        .toast span {
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
            min-width: 0;
        }

        /* Loading Spinner */
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Sound Controls */
        .sound-controls {
            position: fixed;
            bottom: 80px;
            left: 15px;
            z-index: 999;
        }

        .sound-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .sound-btn:hover {
            transform: scale(1.1);
        }

        .sound-btn.muted {
            background: linear-gradient(45deg, var(--text-secondary), #78909c);
        }

        /* Mobile Sidebar Toggle */
        .sidebar-toggle {
            position: fixed;
            bottom: 140px;
            right: 15px;
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            display: none;
        }

        @media (max-width: 767px) {
            .sidebar-toggle {
                display: flex;
            }
        }

        /* Mobile Stats Overlay */
        .mobile-stats-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1001;
            display: none;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .mobile-stats-overlay.active {
            display: flex;
        }

        .mobile-stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--primary);
        }

        .mobile-stats-header h3 {
            color: var(--primary);
            font-size: 18px;
        }

        .mobile-stats-close {
            background: none;
            border: none;
            color: var(--text);
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Landscape Orientation Support */
        @media (orientation: landscape) and (max-height: 600px) {
            .header {
                height: 50px;
                padding: 8px 10px;
            }
            
            .logo {
                font-size: 16px;
            }
            
            .balance-display {
                font-size: 12px;
                padding: 5px 10px;
            }
            
            .container {
                flex-direction: row;
                padding: 10px;
                gap: 10px;
            }
            
            .poker-table-container {
                height: calc(100vh - 140px);
                padding-top: 0;
            }
            
            .mobile-action-controls {
                position: absolute;
                bottom: 10px;
                left: 10px;
                right: 10px;
                border-radius: 8px;
                padding: 8px;
            }
            
            .mobile-stats-btn,
            .sound-controls,
            .sidebar-toggle {
                display: none;
            }
        }

        /* Very small screens */
        @media (max-width: 320px) {
            .header {
                padding: 8px 10px;
            }
            
            .logo span {
                display: none;
            }
            
            .nav-btn {
                padding: 5px 8px;
                font-size: 11px;
            }
            
            .balance-display {
                font-size: 11px;
                padding: 5px 8px;
            }
            
            .player-seat {
                width: 70px;
                height: 90px;
                padding: 5px;
            }
            
            .card {
                width: 22px;
                height: 32px;
                font-size: 10px;
            }
            
            .mobile-chip {
                width: 35px;
                height: 35px;
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Compact Header -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-diamond"></i>
            <span>XCrazyBet Poker</span>
        </div>
        
        <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <i class="fas fa-bars"></i>
        </button>
        
        <nav class="nav-links" id="navLinks">
            <a href="https://xcrazybet.github.io/millioner" class="nav-btn">
                <i class="fas fa-home"></i> Home
            </a>
            <a href="https://xcrazybet.github.io/millioner/games.html" class="nav-btn">
                <i class="fas fa-gamepad"></i> Games
            </a>
            <a href="https://xcrazybet.github.io/millioner/bets.html" class="nav-btn">
                <i class="fas fa-coins"></i> Bets
            </a>
            <a href="https://xcrazybet.github.io/millioner/dashboard.html" class="nav-btn">
                <i class="fas fa-wallet"></i> Deposit
            </a>
        </nav>
        
        <div class="balance-display" id="balanceDisplay">
            <i class="fas fa-wallet"></i> $0.00
        </div>
    </header>

    <!-- Connection Status -->
    <div class="connection-status status-connected" id="connectionStatus">
        <i class="fas fa-wifi"></i>
        <span>Connected</span>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar (Desktop only) -->
        <aside class="sidebar" id="desktopSidebar">
            <!-- Player Info -->
            <div class="sidebar-section">
                <h3><i class="fas fa-user-circle"></i> Player Profile</h3>
                <form class="player-form" id="playerForm">
                    <div class="form-group">
                        <label for="playerName"><i class="fas fa-signature"></i> Display Name</label>
                        <input type="text" id="playerName" class="form-input" 
                               placeholder="Enter your poker name" required
                               value="Player_${Math.floor(Math.random() * 1000)}">
                    </div>
                    
                    <div class="form-group">
                        <label for="playerAge"><i class="fas fa-birthday-cake"></i> Age</label>
                        <input type="number" id="playerAge" class="form-input" 
                               min="18" max="100" value="25" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="playerLevel"><i class="fas fa-trophy"></i> Skill Level</label>
                        <div class="select-wrapper">
                            <select id="playerLevel" class="form-input">
                                <option value="beginner">üü¢ Beginner</option>
                                <option value="intermediate">üü° Intermediate</option>
                                <option value="advanced">üî¥ Advanced</option>
                                <option value="professional">üü£ Professional</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="buyIn"><i class="fas fa-money-bill-wave"></i> Buy-in Amount</label>
                        <input type="number" id="buyIn" class="form-input" 
                               min="10" max="10000" value="500" required>
                    </div>
                    
                    <button type="submit" class="action-btn btn-call" style="margin-top: 5px;">
                        <i class="fas fa-play-circle"></i> Join Poker Table
                    </button>
                </form>
            </div>

            <!-- Top Winners -->
            <div class="sidebar-section">
                <h3><i class="fas fa-crown"></i> Recent Big Wins</h3>
                <div class="winners-list" id="winnersList">
                    <div class="winner-item">
                        <span class="winner-name">Loading...</span>
                        <span class="winner-amount">$0</span>
                    </div>
                </div>
            </div>

            <!-- Game Rules -->
            <div class="sidebar-section">
                <h3><i class="fas fa-gavel"></i> Game Rules</h3>
                <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.5;">
                    <p><strong>Texas Hold'em Poker</strong></p>
                    <p>‚Ä¢ 5 players per table</p>
                    <p>‚Ä¢ Blinds: $1 (small) / $2 (big)</p>
                    <p>‚Ä¢ Min buy-in: $10</p>
                    <p>‚Ä¢ Max buy-in: $10,000</p>
                    <p>‚Ä¢ House rake: 5% (max $10)</p>
                    <p>‚Ä¢ Win chance: 10%</p>
                    <p>‚Ä¢ Fair RNG certified</p>
                </div>
            </div>
        </aside>

        <!-- Mobile Sidebar Overlay -->
        <div class="sidebar-overlay" id="mobileSidebar">
            <div class="sidebar-section">
                <h3><i class="fas fa-user-circle"></i> Player Profile</h3>
                <form class="player-form" id="mobilePlayerForm">
                    <div class="form-group">
                        <label for="mobilePlayerName"><i class="fas fa-signature"></i> Display Name</label>
                        <input type="text" id="mobilePlayerName" class="form-input" 
                               placeholder="Enter your poker name" required
                               value="Player_${Math.floor(Math.random() * 1000)}">
                    </div>
                    
                    <div class="form-group">
                        <label for="mobilePlayerAge"><i class="fas fa-birthday-cake"></i> Age</label>
                        <input type="number" id="mobilePlayerAge" class="form-input" 
                               min="18" max="100" value="25" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="mobilePlayerLevel"><i class="fas fa-trophy"></i> Skill Level</label>
                        <div class="select-wrapper">
                            <select id="mobilePlayerLevel" class="form-input">
                                <option value="beginner">üü¢ Beginner</option>
                                <option value="intermediate">üü° Intermediate</option>
                                <option value="advanced">üî¥ Advanced</option>
                                <option value="professional">üü£ Professional</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="mobileBuyIn"><i class="fas fa-money-bill-wave"></i> Buy-in Amount</label>
                        <input type="number" id="mobileBuyIn" class="form-input" 
                               min="10" max="10000" value="500" required>
                    </div>
                    
                    <button type="submit" class="action-btn btn-call" style="margin-top: 5px;">
                        <i class="fas fa-play-circle"></i> Join Poker Table
                    </button>
                </form>
            </div>

            <div class="sidebar-section">
                <h3><i class="fas fa-crown"></i> Recent Winners</h3>
                <div class="winners-list" id="mobileWinnersList">
                    <div class="winner-item">
                        <span class="winner-name">Loading...</span>
                        <span class="winner-amount">$0</span>
                    </div>
                </div>
            </div>
            
            <button class="action-btn btn-fold" onclick="closeMobileSidebar()" style="margin-top: 20px;">
                <i class="fas fa-times"></i> Close
            </button>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Poker Table -->
            <div class="poker-table-container" id="pokerTableContainer">
                <div class="poker-table" id="pokerTable">
                    <div class="table-felt"></div>
                    
                    <!-- Community Cards -->
                    <div class="table-center">
                        <div class="pot-display" id="potDisplay">Pot: $0</div>
                        <div class="round-display" id="roundDisplay">Pre-flop</div>
                        <div class="community-cards" id="communityCards">
                            <!-- Cards will be added here -->
                        </div>
                    </div>
                    
                    <!-- Player Seats -->
                    <div class="player-seat" id="seat0">
                        <div class="player-info">
                            <div class="player-name" id="seat0Name">You</div>
                            <div class="player-stack" id="seat0Stack">$0</div>
                        </div>
                        <div class="player-cards" id="seat0Cards"></div>
                        <div class="player-status" id="seat0Status"></div>
                    </div>
                    
                    <div class="player-seat" id="seat1">
                        <div class="player-info">
                            <div class="player-name" id="seat1Name">Player 1</div>
                            <div class="player-stack" id="seat1Stack">$100</div>
                        </div>
                        <div class="player-cards" id="seat1Cards"></div>
                        <div class="player-status" id="seat1Status"></div>
                    </div>
                    
                    <div class="player-seat" id="seat2">
                        <div class="player-info">
                            <div class="player-name" id="seat2Name">Player 2</div>
                            <div class="player-stack" id="seat2Stack">$100</div>
                        </div>
                        <div class="player-cards" id="seat2Cards"></div>
                        <div class="player-status" id="seat2Status"></div>
                    </div>
                    
                    <div class="player-seat" id="seat3">
                        <div class="player-info">
                            <div class="player-name" id="seat3Name">Player 3</div>
                            <div class="player-stack" id="seat3Stack">$100</div>
                        </div>
                        <div class="player-cards" id="seat3Cards"></div>
                        <div class="player-status" id="seat3Status"></div>
                    </div>
                    
                    <div class="player-seat" id="seat4">
                        <div class="player-info">
                            <div class="player-name" id="seat4Name">Player 4</div>
                            <div class="player-stack" id="seat4Stack">$100</div>
                        </div>
                        <div class="player-cards" id="seat4Cards"></div>
                        <div class="player-status" id="seat4Status"></div>
                    </div>
                </div>

                <!-- Game State Overlay -->
                <div class="game-state-overlay" id="gameStateOverlay" style="display: none;">
                    <div class="state-message" id="stateMessage">
                        <h3>Game Loading...</h3>
                        <p>Please wait while we set up your table</p>
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <!-- Desktop Action Controls -->
            <div class="desktop-action-controls" id="desktopActionControls">
                <button class="action-btn btn-fold" id="btnFold">
                    <i class="fas fa-times"></i> Fold
                </button>
                <button class="action-btn btn-check" id="btnCheck">
                    <i class="fas fa-check"></i> Check
                </button>
                <button class="action-btn btn-call" id="btnCall">
                    <i class="fas fa-handshake"></i> Call $0
                </button>
                <button class="action-btn btn-raise" id="btnRaise">
                    <i class="fas fa-arrow-up"></i> Raise
                </button>
                <button class="action-btn btn-allin" id="btnAllIn">
                    <i class="fas fa-fire"></i> All In
                </button>
                
                <div class="bet-controls" style="grid-column: 1 / -1; display: flex; gap: 10px; align-items: center;">
                    <input type="number" class="form-input" id="desktopBetAmount" value="0" min="0" placeholder="Bet amount" style="flex: 1;">
                    <div class="chip-selector" style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <div class="chip chip-1" data-amount="1">$1</div>
                        <div class="chip chip-5" data-amount="5">$5</div>
                        <div class="chip chip-10" data-amount="10">$10</div>
                        <div class="chip chip-25" data-amount="25">$25</div>
                        <div class="chip chip-100" data-amount="100">$100</div>
                    </div>
                </div>
            </div>

            <!-- Mobile Action Controls (Fixed at bottom) -->
            <div class="mobile-action-controls" id="mobileActionControls">
                <div class="mobile-action-buttons">
                    <button class="action-btn btn-fold" id="mobileBtnFold">
                        <i class="fas fa-times"></i> Fold
                    </button>
                    <button class="action-btn btn-check" id="mobileBtnCheck">
                        <i class="fas fa-check"></i> Check
                    </button>
                    <button class="action-btn btn-call" id="mobileBtnCall">
                        <i class="fas fa-handshake"></i> Call
                    </button>
                    <button class="action-btn btn-raise" id="mobileBtnRaise">
                        <i class="fas fa-arrow-up"></i> Raise
                    </button>
                    <button class="action-btn btn-allin" id="mobileBtnAllIn">
                        <i class="fas fa-fire"></i> All In
                    </button>
                    <button class="action-btn btn-check" id="mobileBtnAutoFold" style="background: var(--danger);">
                        <i class="fas fa-robot"></i> Auto
                    </button>
                </div>
                
                <div class="mobile-bet-controls">
                    <input type="number" class="mobile-bet-input" id="mobileBetAmount" value="0" min="0" placeholder="Bet amount">
                    <button class="action-btn btn-check" id="mobileBtnBet" style="background: var(--warning);">
                        <i class="fas fa-check"></i> Bet
                    </button>
                </div>
                
                <div class="mobile-chip-selector">
                    <div class="mobile-chip chip-1" data-amount="1">$1</div>
                    <div class="mobile-chip chip-5" data-amount="5">$5</div>
                    <div class="mobile-chip chip-10" data-amount="10">$10</div>
                    <div class="mobile-chip chip-25" data-amount="25">$25</div>
                    <div class="mobile-chip chip-100" data-amount="100">$100</div>
                    <div class="mobile-chip chip-500" data-amount="500">$500</div>
                </div>
            </div>

            <!-- Game Stats (Desktop only) -->
            <div class="game-info">
                <h3 style="color: var(--primary); margin-bottom: 15px;">
                    <i class="fas fa-chart-bar"></i> Session Stats
                </h3>
                <div class="game-stats">
                    <div class="stat-box">
                        <div class="stat-label">Hands Played</div>
                        <div class="stat-value" id="totalHands">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Net Profit</div>
                        <div class="stat-value" id="netProfit">$0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Session Time</div>
                        <div class="stat-value" id="sessionTime">0m</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Current Bet</div>
                        <div class="stat-value" id="currentBet">$0</div>
                    </div>
                </div>
            </div>

            <!-- Game History (Desktop only) -->
            <div class="game-history">
                <div class="history-title">
                    <i class="fas fa-history"></i> Hand History
                </div>
                <div class="history-list" id="historyList">
                    <div class="history-item">
                        <span>Welcome to XCrazyBet Poker!</span>
                        <span class="history-time">Now</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Mobile Controls -->
    <button class="mobile-stats-btn" id="mobileStatsBtn">
        <i class="fas fa-chart-line"></i>
    </button>
    
    <button class="sidebar-toggle" id="sidebarToggle">
        <i class="fas fa-user"></i>
    </button>
    
    <div class="sound-controls">
        <button class="sound-btn" id="soundBtn">
            <i class="fas fa-volume-up"></i>
        </button>
    </div>

    <!-- Mobile Stats Overlay -->
    <div class="mobile-stats-overlay" id="mobileStatsOverlay">
        <div class="mobile-stats-header">
            <h3>Session Statistics</h3>
            <button class="mobile-stats-close" id="mobileStatsClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="game-stats" style="display: grid; gap: 15px;">
            <div class="stat-box">
                <div class="stat-label">Hands Played</div>
                <div class="stat-value" id="mobileTotalHands">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Hands Won</div>
                <div class="stat-value" id="mobileHandsWon">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Net Profit</div>
                <div class="stat-value" id="mobileNetProfit">$0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Session Time</div>
                <div class="stat-value" id="mobileSessionTime">0m</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Current Pot</div>
                <div class="stat-value" id="mobileCurrentPot">$0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">To Call</div>
                <div class="stat-value" id="mobileToCall">$0</div>
            </div>
        </div>
        
        <div style="margin-top: 20px;">
            <h3 style="color: var(--primary); margin-bottom: 15px; font-size: 16px;">
                <i class="fas fa-history"></i> Recent Hands
            </h3>
            <div class="history-list" id="mobileHistoryList">
                <div class="history-item">
                    <span>Welcome to XCrazyBet Poker!</span>
                    <span class="history-time">Now</span>
                </div>
            </div>
        </div>
        
        <button class="action-btn btn-fold" onclick="closeMobileStats()" style="margin-top: 20px;">
            <i class="fas fa-times"></i> Close
        </button>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Audio Elements for Sound Effects -->
    <audio id="soundCardDeal" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-card-dealing-sound-1699.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundChip" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundWin" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundLose" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-losing-bleeps-2026.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundFold" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-retro-arcade-game-over-470.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundBet" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ===== FIREBASE CONFIGURATION =====
        const firebaseConfig = {
            apiKey: "AIzaSyA72Yo_YGqno9PX25p3yQBvyflcaM-NqEM",
            authDomain: "x-bet-prod-jd.firebaseapp.com",
            projectId: "x-bet-prod-jd",
            storageBucket: "x-bet-prod-jd.firebasestorage.app",
            messagingSenderId: "499334334535",
            appId: "1:499334334535:web:bebc1bf817e24d9e3c4962"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const functions = firebase.functions();

        // ===== GAME STATE =====
        let pokerGame = {
            currentUser: null,
            gameId: null,
            playerId: null,
            gameState: {
                status: 'waiting',
                players: [],
                deck: [],
                communityCards: [],
                pot: 0,
                dealerPosition: 0,
                currentPlayer: null,
                currentBet: 0,
                round: 'preflop',
                winners: [],
                rake: 0,
                timestamp: null
            },
            playerProfile: null,
            balance: 0,
            session: {
                startTime: null,
                handsPlayed: 0,
                handsWon: 0,
                netProfit: 0,
                dailyLimit: 100,
                dailyLossLimit: 1000,
                lastActionTime: null
            },
            gameHistory: [],
            recentWinners: [],
            aiPlayers: [],
            connectionStatus: 'connected',
            isProcessing: false,
            actionLock: false,
            gameConfig: {
                winRate: 0.10,
                houseEdge: 0.90,
                minBet: 1,
                maxBet: 10000,
                blinds: { small: 1, big: 2 },
                rakePercentage: 0.05,
                maxRake: 10
            },
            soundEnabled: true,
            autoFold: false,
            isMobile: /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)
        };

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', async () => {
            await initGame();
            setupEventListeners();
            setupMobileUI();
            
            // Check orientation
            checkOrientation();
            window.addEventListener('resize', checkOrientation);
            window.addEventListener('orientationchange', checkOrientation);
            
            // Prevent zoom on mobile
            document.addEventListener('touchstart', (e) => {
                if (e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            document.addEventListener('gesturestart', (e) => {
                e.preventDefault();
            });
        });

        async function initGame() {
            try {
                await checkAuth();
                await loadConfig();
                await loadBalance();
                await loadRecentWinners();
                await loadGameHistory();
                startSessionTimer();
                setupConnectionMonitoring();
                logGameEvent('system', 'Game initialized');
                
                // Update mobile UI
                updateMobileStats();
            } catch (error) {
                console.error('Initialization error:', error);
                showToast('Failed to initialize game', 'error');
            }
        }

        // ===== AUTHENTICATION =====
        async function checkAuth() {
            return new Promise((resolve, reject) => {
                auth.onAuthStateChanged(async (user) => {
                    if (!user) {
                        showToast('Please login to play', 'error');
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 2000);
                        reject(new Error('Not authenticated'));
                        return;
                    }
                    pokerGame.currentUser = user;
                    pokerGame.playerId = user.uid;
                    logGameEvent('auth', 'User authenticated');
                    resolve();
                });
            });
        }

        // ===== CONFIGURATION =====
        async function loadConfig() {
            try {
                const configDoc = await db.collection('config').doc('poker').get();
                if (configDoc.exists) {
                    pokerGame.gameConfig = { ...pokerGame.gameConfig, ...configDoc.data() };
                    logGameEvent('config', 'Game configuration loaded');
                }
            } catch (error) {
                console.error('Error loading config:', error);
            }
        }

        // ===== BALANCE MANAGEMENT =====
        async function loadBalance() {
            try {
                const doc = await db.collection("wallets").doc(pokerGame.currentUser.uid).get();
                if (doc.exists) {
                    pokerGame.balance = doc.data().balance || 0;
                    updateBalanceDisplay();
                }
            } catch (error) {
                console.error('Error loading balance:', error);
                showToast('Error loading balance', 'error');
            }
        }

        function updateBalanceDisplay() {
            const element = document.getElementById('balanceDisplay');
            if (element) {
                element.innerHTML = `<i class="fas fa-wallet"></i> $${pokerGame.balance.toFixed(2)}`;
            }
        }

        // ===== MOBILE UI SETUP =====
        function setupMobileUI() {
            // Show mobile menu toggle on small screens
            if (window.innerWidth < 768) {
                document.getElementById('mobileMenuToggle').style.display = 'block';
                document.getElementById('navLinks').style.display = 'none';
            } else {
                document.getElementById('mobileMenuToggle').style.display = 'none';
                document.getElementById('navLinks').style.display = 'flex';
            }
            
            // Update mobile stats initially
            updateMobileStats();
        }

        function checkOrientation() {
            const isLandscape = window.innerWidth > window.innerHeight;
            const container = document.getElementById('pokerTableContainer');
            
            if (container && isLandscape && window.innerHeight < 600) {
                // Landscape mode on mobile
                container.style.paddingTop = '0';
                container.style.height = 'calc(100vh - 140px)';
            } else if (container) {
                // Portrait or desktop
                if (window.innerWidth < 768) {
                    container.style.paddingTop = '56.25%';
                    container.style.height = 'auto';
                } else {
                    container.style.paddingTop = '0';
                    container.style.height = '500px';
                }
            }
        }

        // ===== EVENT LISTENERS =====
        function setupEventListeners() {
            // Player forms
            document.getElementById('playerForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                joinGame();
            });
            
            document.getElementById('mobilePlayerForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                joinGame(true);
            });

            // Desktop action buttons
            document.getElementById('btnFold')?.addEventListener('click', () => playerAction('fold'));
            document.getElementById('btnCheck')?.addEventListener('click', () => playerAction('check'));
            document.getElementById('btnCall')?.addEventListener('click', () => playerAction('call'));
            document.getElementById('btnRaise')?.addEventListener('click', () => playerAction('raise'));
            document.getElementById('btnAllIn')?.addEventListener('click', () => playerAction('allin'));

            // Mobile action buttons
            document.getElementById('mobileBtnFold')?.addEventListener('click', () => playerAction('fold'));
            document.getElementById('mobileBtnCheck')?.addEventListener('click', () => playerAction('check'));
            document.getElementById('mobileBtnCall')?.addEventListener('click', () => playerAction('call'));
            document.getElementById('mobileBtnRaise')?.addEventListener('click', () => playerAction('raise'));
            document.getElementById('mobileBtnAllIn')?.addEventListener('click', () => playerAction('allin'));
            document.getElementById('mobileBtnBet')?.addEventListener('click', () => playerAction('raise'));
            document.getElementById('mobileBtnAutoFold')?.addEventListener('click', toggleAutoFold);

            // Chip buttons
            document.querySelectorAll('.chip, .mobile-chip').forEach(chip => {
                chip.addEventListener('click', (e) => {
                    const amount = parseInt(e.target.dataset.amount || e.target.closest('[data-amount]').dataset.amount);
                    const isMobile = e.target.classList.contains('mobile-chip') || e.target.closest('.mobile-chip');
                    
                    if (isMobile) {
                        const currentBet = parseInt(document.getElementById('mobileBetAmount').value) || 0;
                        document.getElementById('mobileBetAmount').value = currentBet + amount;
                    } else {
                        const currentBet = parseInt(document.getElementById('desktopBetAmount').value) || 0;
                        document.getElementById('desktopBetAmount').value = currentBet + amount;
                    }
                    
                    // Animate chip
                    chip.classList.add('chip-animation');
                    setTimeout(() => chip.classList.remove('chip-animation'), 800);
                    
                    // Play chip sound
                    playSound('chip');
                });
            });

            // Bet input validation
            document.getElementById('desktopBetAmount')?.addEventListener('input', validateBetInput);
            document.getElementById('mobileBetAmount')?.addEventListener('input', validateBetInput);

            // Mobile menu toggle
            document.getElementById('mobileMenuToggle')?.addEventListener('click', toggleMobileMenu);
            
            // Mobile sidebar toggle
            document.getElementById('sidebarToggle')?.addEventListener('click', openMobileSidebar);
            
            // Mobile stats
            document.getElementById('mobileStatsBtn')?.addEventListener('click', openMobileStats);
            document.getElementById('mobileStatsClose')?.addEventListener('click', closeMobileStats);
            
            // Sound control
            document.getElementById('soundBtn')?.addEventListener('click', toggleSound);

            // Close overlays when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.sidebar-overlay') && !e.target.closest('.sidebar-toggle')) {
                    closeMobileSidebar();
                }
                if (!e.target.closest('.mobile-stats-overlay') && !e.target.closest('.mobile-stats-btn')) {
                    closeMobileStats();
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (pokerGame.isProcessing || pokerGame.actionLock) return;
                
                switch (e.key.toLowerCase()) {
                    case 'f':
                        playerAction('fold');
                        break;
                    case 'c':
                        if (getCallAmount() === 0) {
                            playerAction('check');
                        } else {
                            playerAction('call');
                        }
                        break;
                    case 'r':
                        playerAction('raise');
                        break;
                    case 'a':
                        playerAction('allin');
                        break;
                    case ' ':
                        if (getCallAmount() === 0) {
                            playerAction('check');
                        } else {
                            playerAction('call');
                        }
                        break;
                }
            });
        }

        function toggleMobileMenu() {
            const navLinks = document.getElementById('navLinks');
            if (navLinks.style.display === 'flex') {
                navLinks.style.display = 'none';
            } else {
                navLinks.style.display = 'flex';
            }
        }

        function openMobileSidebar() {
            document.getElementById('mobileSidebar').classList.add('active');
            // Copy values from desktop form
            document.getElementById('mobilePlayerName').value = document.getElementById('playerName').value;
            document.getElementById('mobilePlayerAge').value = document.getElementById('playerAge').value;
            document.getElementById('mobilePlayerLevel').value = document.getElementById('playerLevel').value;
            document.getElementById('mobileBuyIn').value = document.getElementById('buyIn').value;
        }

        function closeMobileSidebar() {
            document.getElementById('mobileSidebar').classList.remove('active');
        }

        function openMobileStats() {
            updateMobileStats();
            document.getElementById('mobileStatsOverlay').classList.add('active');
        }

        function closeMobileStats() {
            document.getElementById('mobileStatsOverlay').classList.remove('active');
        }

        function toggleSound() {
            pokerGame.soundEnabled = !pokerGame.soundEnabled;
            const soundBtn = document.getElementById('soundBtn');
            if (pokerGame.soundEnabled) {
                soundBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                soundBtn.classList.remove('muted');
                showToast('Sound enabled', 'success');
            } else {
                soundBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
                soundBtn.classList.add('muted');
                showToast('Sound disabled', 'info');
            }
        }

        function toggleAutoFold() {
            pokerGame.autoFold = !pokerGame.autoFold;
            const btn = document.getElementById('mobileBtnAutoFold');
            if (pokerGame.autoFold) {
                btn.innerHTML = '<i class="fas fa-robot"></i> Auto ON';
                btn.style.background = 'var(--success)';
                showToast('Auto-fold enabled', 'info');
            } else {
                btn.innerHTML = '<i class="fas fa-robot"></i> Auto';
                btn.style.background = 'var(--danger)';
                showToast('Auto-fold disabled', 'info');
            }
        }

        // ===== JOIN GAME =====
        async function joinGame(isMobile = false) {
            if (pokerGame.isProcessing) {
                showToast('Please wait...', 'warning');
                return;
            }

            let playerName, playerAge, playerLevel, buyIn;
            
            if (isMobile) {
                playerName = document.getElementById('mobilePlayerName').value.trim();
                playerAge = parseInt(document.getElementById('mobilePlayerAge').value);
                playerLevel = document.getElementById('mobilePlayerLevel').value;
                buyIn = parseInt(document.getElementById('mobileBuyIn').value);
                closeMobileSidebar();
            } else {
                playerName = document.getElementById('playerName').value.trim();
                playerAge = parseInt(document.getElementById('playerAge').value);
                playerLevel = document.getElementById('playerLevel').value;
                buyIn = parseInt(document.getElementById('buyIn').value);
            }

            // Validation
            if (!playerName || playerName.length < 3) {
                showToast('Enter a valid name (min 3 chars)', 'error');
                return;
            }

            if (playerAge < 18) {
                showToast('You must be 18+ to play', 'error');
                return;
            }

            if (buyIn < pokerGame.gameConfig.minBet || buyIn > pokerGame.gameConfig.maxBet) {
                showToast(`Buy-in must be between $${pokerGame.gameConfig.minBet} and $${pokerGame.gameConfig.maxBet}`, 'error');
                return;
            }

            if (buyIn > pokerGame.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }

            // Check daily limits
            const dailyStats = await getDailyStats();
            if (dailyStats.handsPlayed >= pokerGame.session.dailyLimit) {
                showToast('Daily hand limit reached', 'error');
                return;
            }

            if (dailyStats.dailyLoss >= pokerGame.session.dailyLossLimit) {
                showToast('Daily loss limit reached', 'error');
                return;
            }

            pokerGame.isProcessing = true;
            showGameState('Setting up table...');

            try {
                // Simulate balance deduction (replace with actual Cloud Function call)
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // For demo purposes - deduct from local balance
                pokerGame.balance -= buyIn;
                updateBalanceDisplay();

                // Create player profile
                pokerGame.playerProfile = {
                    id: pokerGame.playerId,
                    name: playerName,
                    age: playerAge,
                    level: playerLevel,
                    stack: buyIn,
                    position: 0,
                    isAI: false,
                    cards: [],
                    isActive: true,
                    isFolded: false,
                    currentBet: 0,
                    isAllIn: false,
                    hasActed: false
                };

                // Generate AI players
                await generateAIPlayers();

                // Initialize game
                await initializeGame();

                showToast('Welcome to the table!', 'success');
                logGameEvent('join', `Joined table with $${buyIn} buy-in`);
                
                // Play welcome sound
                playSound('chip');

            } catch (error) {
                console.error('Join game error:', error);
                showToast(error.message || 'Failed to join game', 'error');
            } finally {
                pokerGame.isProcessing = false;
                hideGameState();
            }
        }

        // ===== GAME INITIALIZATION =====
        async function generateAIPlayers() {
            const aiNames = [
                "Ace_High", "BluffMaster", "CardShark", "PokerFace", "RoyalFlush",
                "All_In_Andy", "ChipLeader", "DealerDave", "FoldKing", "RiverRat"
            ];
            
            pokerGame.aiPlayers = [];
            const usedNames = new Set([pokerGame.playerProfile.name]);

            for (let i = 1; i <= 4; i++) {
                let name;
                do {
                    name = aiNames[Math.floor(Math.random() * aiNames.length)];
                } while (usedNames.has(name));
                usedNames.add(name);

                const stack = Math.floor(Math.random() * (5000 - 200 + 1)) + 200;
                const aiStyle = Math.random() > 0.5 ? 'aggressive' : 'conservative';
                
                pokerGame.aiPlayers.push({
                    id: `ai_${i}_${Date.now()}`,
                    name: name,
                    stack: stack,
                    position: i,
                    isAI: true,
                    cards: [],
                    isActive: true,
                    isFolded: false,
                    currentBet: 0,
                    isAllIn: false,
                    hasActed: false,
                    aiStyle: aiStyle,
                    aiSkill: Math.random() * 0.7 + 0.3
                });
            }
        }

        async function initializeGame() {
            pokerGame.gameId = `poker_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            
            // Combine players
            pokerGame.gameState.players = [pokerGame.playerProfile, ...pokerGame.aiPlayers];
            pokerGame.gameState.status = 'waiting';
            pokerGame.gameState.deck = createDeck();
            pokerGame.gameState.communityCards = [];
            pokerGame.gameState.pot = 0;
            pokerGame.gameState.currentBet = 0;
            pokerGame.gameState.round = 'preflop';
            pokerGame.gameState.timestamp = new Date();

            // Update UI
            updateAllDisplays();
            
            // Show appropriate action controls
            if (pokerGame.isMobile) {
                document.getElementById('mobileActionControls').classList.add('active');
            } else {
                document.getElementById('desktopActionControls').classList.add('active');
            }
            
            // Start the game
            setTimeout(() => startNewHand(), 1000);
        }

        // ===== GAME FLOW =====
        async function startNewHand() {
            if (pokerGame.isProcessing) return;
            
            pokerGame.isProcessing = true;
            showGameState('Starting new hand...');
            
            try {
                // Check session limits
                if (pokerGame.session.handsPlayed >= pokerGame.session.dailyLimit) {
                    showToast('Daily hand limit reached', 'warning');
                    endSession();
                    return;
                }

                // Reset game state
                pokerGame.gameState.deck = createDeck();
                pokerGame.gameState.communityCards = [];
                pokerGame.gameState.pot = 0;
                pokerGame.gameState.currentBet = 0;
                pokerGame.gameState.round = 'preflop';
                pokerGame.gameState.winners = [];
                
                // Reset player states
                pokerGame.gameState.players.forEach(player => {
                    player.cards = [];
                    player.isFolded = false;
                    player.currentBet = 0;
                    player.isAllIn = false;
                    player.hasActed = false;
                });

                // Rotate dealer
                pokerGame.gameState.dealerPosition = (pokerGame.gameState.dealerPosition + 1) % 5;
                
                // Deal cards
                await dealCards();
                
                // Post blinds
                await postBlinds();
                
                // Update UI
                updateAllDisplays();
                updateMobileStats();
                
                // Start betting round
                setTimeout(() => {
                    startBettingRound();
                    pokerGame.isProcessing = false;
                    hideGameState();
                }, 1500);
                
                pokerGame.session.handsPlayed++;
                updateSessionDisplay();
                logGameEvent('hand_start', `Hand #${pokerGame.session.handsPlayed} started`);
                
                // Play dealing sound
                playSound('cardDeal');
                
            } catch (error) {
                console.error('Error starting new hand:', error);
                showToast('Error starting hand', 'error');
                pokerGame.isProcessing = false;
                hideGameState();
            }
        }

        async function dealCards() {
            // Deal two cards to each player
            for (let i = 0; i < 2; i++) {
                for (const player of pokerGame.gameState.players) {
                    if (player.isActive) {
                        const card = pokerGame.gameState.deck.pop();
                        player.cards.push(card);
                        
                        // Animate card deal
                        animateCardDeal(player.position);
                    }
                }
                await sleep(300);
            }
        }

        async function postBlinds() {
            const smallBlindPos = (pokerGame.gameState.dealerPosition + 1) % 5;
            const bigBlindPos = (pokerGame.gameState.dealerPosition + 2) % 5;
            
            const sbPlayer = pokerGame.gameState.players[smallBlindPos];
            const bbPlayer = pokerGame.gameState.players[bigBlindPos];
            
            // Post small blind
            const sbAmount = Math.min(pokerGame.gameConfig.blinds.small, sbPlayer.stack);
            sbPlayer.currentBet = sbAmount;
            sbPlayer.stack -= sbAmount;
            pokerGame.gameState.pot += sbAmount;
            
            // Post big blind
            const bbAmount = Math.min(pokerGame.gameConfig.blinds.big, bbPlayer.stack);
            bbPlayer.currentBet = bbAmount;
            bbPlayer.stack -= bbAmount;
            pokerGame.gameState.pot += bbAmount;
            pokerGame.gameState.currentBet = bbAmount;
            
            showToast(`${sbPlayer.name} posts small blind $${sbAmount}`, 'info');
            showToast(`${bbPlayer.name} posts big blind $${bbAmount}`, 'info');
            
            // Set first player to act (after big blind)
            const firstPlayerPos = (pokerGame.gameState.dealerPosition + 3) % 5;
            pokerGame.gameState.currentPlayer = pokerGame.gameState.players[firstPlayerPos].id;
            
            // Play chip sound
            playSound('chip');
        }

        function startBettingRound() {
            pokerGame.gameState.players.forEach(player => {
                player.hasActed = false;
            });
            
            // Check if human player should auto-fold
            const humanPlayer = pokerGame.gameState.players.find(p => p.id === pokerGame.playerId);
            if (pokerGame.autoFold && humanPlayer && !humanPlayer.isFolded) {
                setTimeout(() => {
                    playerAction('fold');
                }, 1000);
                return;
            }
            
            // Enable player actions if it's their turn
            const currentPlayer = pokerGame.gameState.players.find(p => p.id === pokerGame.gameState.currentPlayer);
            if (currentPlayer && !currentPlayer.isAI) {
                enablePlayerActions();
            } else {
                disablePlayerActions();
                // Start AI actions
                setTimeout(() => processAIActions(), 1000);
            }
            
            updateAllDisplays();
            updateMobileStats();
            logGameEvent('betting_round', `${pokerGame.gameState.round} betting started`);
        }

        // ===== PLAYER ACTIONS =====
        function enablePlayerActions() {
            if (pokerGame.actionLock) return;
            
            const player = getCurrentPlayer();
            if (!player || player.isAI) return;
            
            const callAmount = getCallAmount(player);
            const canCheck = callAmount === 0;
            
            // Desktop controls
            if (document.getElementById('btnFold')) {
                document.getElementById('btnFold').disabled = false;
                document.getElementById('btnCheck').disabled = !canCheck;
                document.getElementById('btnCall').disabled = callAmount === 0;
                document.getElementById('btnRaise').disabled = false;
                document.getElementById('btnAllIn').disabled = false;
                
                if (callAmount > 0) {
                    document.getElementById('btnCall').innerHTML = 
                        `<i class="fas fa-handshake"></i> Call $${callAmount}`;
                }
            }
            
            // Mobile controls
            if (document.getElementById('mobileBtnFold')) {
                document.getElementById('mobileBtnFold').disabled = false;
                document.getElementById('mobileBtnCheck').disabled = !canCheck;
                document.getElementById('mobileBtnCall').disabled = callAmount === 0;
                document.getElementById('mobileBtnRaise').disabled = false;
                document.getElementById('mobileBtnAllIn').disabled = false;
                
                if (callAmount > 0) {
                    document.getElementById('mobileBtnCall').innerHTML = 
                        `<i class="fas fa-handshake"></i> Call $${callAmount}`;
                }
                
                // Update mobile bet input placeholder
                document.getElementById('mobileBetAmount').placeholder = `Min: $${callAmount * 2 || pokerGame.gameConfig.blinds.big * 2}`;
            }
            
            // Set minimum raise for desktop
            const minRaise = Math.max(callAmount * 2, pokerGame.gameConfig.blinds.big * 2);
            if (document.getElementById('desktopBetAmount')) {
                document.getElementById('desktopBetAmount').value = minRaise;
                document.getElementById('desktopBetAmount').min = minRaise;
            }
            
            showToast(`Your turn to act (${pokerGame.gameState.round})`, 'info');
        }

        function disablePlayerActions() {
            // Desktop controls
            if (document.getElementById('btnFold')) {
                document.getElementById('btnFold').disabled = true;
                document.getElementById('btnCheck').disabled = true;
                document.getElementById('btnCall').disabled = true;
                document.getElementById('btnRaise').disabled = true;
                document.getElementById('btnAllIn').disabled = true;
            }
            
            // Mobile controls
            if (document.getElementById('mobileBtnFold')) {
                document.getElementById('mobileBtnFold').disabled = true;
                document.getElementById('mobileBtnCheck').disabled = true;
                document.getElementById('mobileBtnCall').disabled = true;
                document.getElementById('mobileBtnRaise').disabled = true;
                document.getElementById('mobileBtnAllIn').disabled = true;
                document.getElementById('mobileBtnBet').disabled = true;
            }
        }

        async function playerAction(action) {
            if (pokerGame.actionLock || pokerGame.isProcessing) return;
            
            const player = getCurrentPlayer();
            if (!player || player.isAI || player.id !== pokerGame.playerId) return;
            
            pokerGame.actionLock = true;
            disablePlayerActions();
            
            try {
                let amount = 0;
                let actionTaken = false;
                
                switch (action) {
                    case 'fold':
                        player.isFolded = true;
                        showToast(`${player.name} folds`, 'info');
                        actionTaken = true;
                        logGameAction(player, 'fold', 0);
                        playSound('fold');
                        break;
                        
                    case 'check':
                        if (getCallAmount(player) > 0) {
                            showToast('Cannot check, must call or fold', 'warning');
                            pokerGame.actionLock = false;
                            enablePlayerActions();
                            return;
                        }
                        showToast(`${player.name} checks`, 'info');
                        actionTaken = true;
                        logGameAction(player, 'check', 0);
                        break;
                        
                    case 'call':
                        amount = getCallAmount(player);
                        if (amount === 0) {
                            showToast('Nothing to call', 'warning');
                            pokerGame.actionLock = false;
                            enablePlayerActions();
                            return;
                        }
                        
                        const callAmount = Math.min(amount, player.stack);
                        player.currentBet += callAmount;
                        player.stack -= callAmount;
                        pokerGame.gameState.pot += callAmount;
                        
                        if (player.stack === 0) {
                            player.isAllIn = true;
                            showToast(`${player.name} calls all-in for $${callAmount}!`, 'warning');
                        } else {
                            showToast(`${player.name} calls $${callAmount}`, 'info');
                        }
                        
                        actionTaken = true;
                        logGameAction(player, 'call', callAmount);
                        playSound('bet');
                        break;
                        
                    case 'raise':
                        let raiseAmount;
                        if (pokerGame.isMobile) {
                            raiseAmount = parseInt(document.getElementById('mobileBetAmount').value);
                        } else {
                            raiseAmount = parseInt(document.getElementById('desktopBetAmount').value);
                        }
                        
                        if (isNaN(raiseAmount) || raiseAmount < getCallAmount(player) * 2) {
                            const minRaise = getCallAmount(player) * 2;
                            showToast(`Minimum raise is $${minRaise}`, 'warning');
                            pokerGame.actionLock = false;
                            enablePlayerActions();
                            return;
                        }
                        
                        if (raiseAmount > player.stack) {
                            raiseAmount = player.stack;
                        }
                        
                        const totalBet = player.currentBet + raiseAmount;
                        if (totalBet <= pokerGame.gameState.currentBet) {
                            showToast(`Raise must be higher than current bet ($${pokerGame.gameState.currentBet})`, 'warning');
                            pokerGame.actionLock = false;
                            enablePlayerActions();
                            return;
                        }
                        
                        player.currentBet = totalBet;
                        player.stack -= raiseAmount;
                        pokerGame.gameState.pot += raiseAmount;
                        pokerGame.gameState.currentBet = totalBet;
                        
                        if (player.stack === 0) {
                            player.isAllIn = true;
                            showToast(`${player.name} raises all-in to $${totalBet}!`, 'warning');
                        } else {
                            showToast(`${player.name} raises to $${totalBet}`, 'info');
                        }
                        
                        actionTaken = true;
                        logGameAction(player, 'raise', raiseAmount);
                        playSound('bet');
                        break;
                        
                    case 'allin':
                        amount = player.stack;
                        player.currentBet += amount;
                        player.stack = 0;
                        pokerGame.gameState.pot += amount;
                        player.isAllIn = true;
                        
                        if (player.currentBet > pokerGame.gameState.currentBet) {
                            pokerGame.gameState.currentBet = player.currentBet;
                        }
                        
                        showToast(`${player.name} goes ALL-IN for $${amount}!`, 'warning');
                        actionTaken = true;
                        logGameAction(player, 'allin', amount);
                        playSound('chip');
                        break;
                }
                
                if (actionTaken) {
                    player.hasActed = true;
                    updateAllDisplays();
                    updateMobileStats();
                    
                    // Reset bet inputs
                    if (pokerGame.isMobile) {
                        document.getElementById('mobileBetAmount').value = '';
                    } else {
                        const minRaise = Math.max(getCallAmount(player) * 2, pokerGame.gameConfig.blinds.big * 2);
                        document.getElementById('desktopBetAmount').value = minRaise;
                    }
                    
                    // Check if betting round is complete
                    if (isBettingRoundComplete()) {
                        advanceGame();
                    } else {
                        advanceToNextPlayer();
                    }
                }
                
            } catch (error) {
                console.error('Player action error:', error);
                showToast('Action failed', 'error');
            } finally {
                pokerGame.actionLock = false;
            }
        }

        function getCallAmount(player = null) {
            if (!player) {
                player = getCurrentPlayer();
            }
            if (!player) return 0;
            
            return Math.max(0, pokerGame.gameState.currentBet - player.currentBet);
        }

        function getCurrentPlayer() {
            return pokerGame.gameState.players.find(p => p.id === pokerGame.gameState.currentPlayer);
        }

        function validateBetInput(e) {
            const player = getCurrentPlayer();
            if (player && !player.isAI) {
                const maxBet = player.stack;
                const value = parseInt(e.target.value) || 0;
                if (value > maxBet) {
                    e.target.value = maxBet;
                }
            }
        }

        // ===== GAME PROGRESSION =====
        function advanceToNextPlayer() {
            let currentIndex = pokerGame.gameState.players.findIndex(p => p.id === pokerGame.gameState.currentPlayer);
            let attempts = 0;
            
            while (attempts < pokerGame.gameState.players.length) {
                currentIndex = (currentIndex + 1) % pokerGame.gameState.players.length;
                const nextPlayer = pokerGame.gameState.players[currentIndex];
                
                if (nextPlayer.isActive && !nextPlayer.isFolded && !nextPlayer.isAllIn) {
                    pokerGame.gameState.currentPlayer = nextPlayer.id;
                    
                    if (nextPlayer.isAI) {
                        disablePlayerActions();
                        setTimeout(() => processAIActions(), 500);
                    } else {
                        enablePlayerActions();
                    }
                    
                    updateAllDisplays();
                    return;
                }
                
                attempts++;
            }
            
            // If we get here, betting round might be complete
            if (isBettingRoundComplete()) {
                advanceGame();
            }
        }

        function isBettingRoundComplete() {
            const activePlayers = pokerGame.gameState.players.filter(p => 
                p.isActive && !p.isFolded && !p.isAllIn
            );
            
            if (activePlayers.length <= 1) return true;
            
            const allActed = activePlayers.every(p => p.hasActed || p.isAllIn);
            const allEqualized = activePlayers.every(p => 
                p.currentBet === pokerGame.gameState.currentBet || p.isAllIn
            );
            
            return allActed && allEqualized;
        }

        async function advanceGame() {
            switch (pokerGame.gameState.round) {
                case 'preflop':
                    await dealCommunityCards(3); // Flop
                    pokerGame.gameState.round = 'flop';
                    break;
                    
                case 'flop':
                    await dealCommunityCards(1); // Turn
                    pokerGame.gameState.round = 'turn';
                    break;
                    
                case 'turn':
                    await dealCommunityCards(1); // River
                    pokerGame.gameState.round = 'river';
                    break;
                    
                case 'river':
                    await showdown();
                    return;
            }
            
            // Reset for new betting round
            pokerGame.gameState.currentBet = 0;
            pokerGame.gameState.players.forEach(player => {
                player.currentBet = 0;
                player.hasActed = false;
            });
            
            // Set first player (small blind if still active, otherwise next active player)
            const sbPos = (pokerGame.gameState.dealerPosition + 1) % 5;
            let firstPlayerPos = sbPos;
            
            for (let i = 0; i < 5; i++) {
                const player = pokerGame.gameState.players[firstPlayerPos];
                if (player.isActive && !player.isFolded && !player.isAllIn) {
                    break;
                }
                firstPlayerPos = (firstPlayerPos + 1) % 5;
            }
            
            pokerGame.gameState.currentPlayer = pokerGame.gameState.players[firstPlayerPos].id;
            pokerGame.gameState.currentBet = 0;
            
            updateAllDisplays();
            updateMobileStats();
            startBettingRound();
        }

        async function dealCommunityCards(count) {
            showGameState(`Dealing ${count} community card${count > 1 ? 's' : ''}...`);
            
            for (let i = 0; i < count; i++) {
                await sleep(800);
                const card = pokerGame.gameState.deck.pop();
                pokerGame.gameState.communityCards.push(card);
                updateCommunityCardsDisplay();
                animateCommunityCard();
                playSound('cardDeal');
            }
            
            hideGameState();
        }

        // ===== AI ACTIONS =====
        async function processAIActions() {
            const player = getCurrentPlayer();
            if (!player || !player.isAI || player.isFolded || player.isAllIn) {
                advanceToNextPlayer();
                return;
            }
            
            // AI thinking delay
            await sleep(1000 + Math.random() * 2000);
            
            const callAmount = getCallAmount(player);
            const decision = makeAIDecision(player, callAmount);
            
            switch (decision.action) {
                case 'fold':
                    player.isFolded = true;
                    showToast(`${player.name} folds`, 'info');
                    logGameAction(player, 'fold', 0);
                    playSound('fold');
                    break;
                    
                case 'check':
                    if (callAmount > 0) {
                        // Can't check when there's a bet, so call instead
                        const callAmountActual = Math.min(callAmount, player.stack);
                        player.currentBet += callAmountActual;
                        player.stack -= callAmountActual;
                        pokerGame.gameState.pot += callAmountActual;
                        
                        if (player.stack === 0) player.isAllIn = true;
                        showToast(`${player.name} calls $${callAmountActual}`, 'info');
                        logGameAction(player, 'call', callAmountActual);
                        playSound('bet');
                    } else {
                        showToast(`${player.name} checks`, 'info');
                        logGameAction(player, 'check', 0);
                    }
                    break;
                    
                case 'call':
                    const callAmountActual = Math.min(callAmount, player.stack);
                    player.currentBet += callAmountActual;
                    player.stack -= callAmountActual;
                    pokerGame.gameState.pot += callAmountActual;
                    
                    if (player.stack === 0) player.isAllIn = true;
                    showToast(`${player.name} calls $${callAmountActual}`, 'info');
                    logGameAction(player, 'call', callAmountActual);
                    playSound('bet');
                    break;
                    
                case 'raise':
                    const raiseAmount = Math.min(decision.amount, player.stack);
                    player.currentBet += raiseAmount;
                    player.stack -= raiseAmount;
                    pokerGame.gameState.pot += raiseAmount;
                    
                    if (player.currentBet > pokerGame.gameState.currentBet) {
                        pokerGame.gameState.currentBet = player.currentBet;
                    }
                    
                    if (player.stack === 0) player.isAllIn = true;
                    showToast(`${player.name} raises to $${player.currentBet}`, 'info');
                    logGameAction(player, 'raise', raiseAmount);
                    playSound('bet');
                    break;
            }
            
            player.hasActed = true;
            updateAllDisplays();
            updateMobileStats();
            
            // Check if betting round is complete
            if (isBettingRoundComplete()) {
                advanceGame();
            } else {
                advanceToNextPlayer();
            }
        }

        function makeAIDecision(player, callAmount) {
            const handStrength = evaluateHandStrength(player);
            const potOdds = callAmount / (pokerGame.gameState.pot + callAmount);
            const randomFactor = Math.random();
            
            let action = 'fold';
            let amount = 0;
            
            // Adjust based on AI style
            let aggression = player.aiStyle === 'aggressive' ? 0.7 : 0.3;
            aggression *= player.aiSkill; // Scale by skill level
            
            if (player.isAllIn) {
                return { action: 'check', amount: 0 };
            }
            
            if (handStrength > 0.8) { // Strong hand
                if (randomFactor < 0.8) {
                    action = 'raise';
                    amount = Math.min(
                        player.stack * 0.5,
                        pokerGame.gameState.currentBet * 2 + Math.random() * 100
                    );
                } else {
                    action = 'call';
                }
            } else if (handStrength > 0.5) { // Medium hand
                if (potOdds < 0.3 && randomFactor < aggression) {
                    action = 'raise';
                    amount = Math.min(player.stack * 0.3, callAmount * 2);
                } else if (callAmount < player.stack * 0.2) {
                    action = 'call';
                } else {
                    action = randomFactor < 0.3 ? 'fold' : 'call';
                }
            } else { // Weak hand
                if (callAmount === 0) {
                    action = randomFactor < aggression * 0.5 ? 'raise' : 'check';
                    if (action === 'raise') {
                        amount = Math.min(player.stack * 0.2, pokerGame.gameConfig.blinds.big * 2);
                    }
                } else if (callAmount < player.stack * 0.1 && randomFactor < 0.4) {
                    action = 'call';
                } else {
                    action = 'fold';
                }
            }
            
            return { action, amount };
        }

        function evaluateHandStrength(player) {
            // Simple hand strength evaluation
            const cards = [...player.cards, ...pokerGame.gameState.communityCards];
            if (cards.length < 2) return 0.5;
            
            let strength = 0;
            
            // High card value
            const highCard = Math.max(...player.cards.map(c => c.value));
            strength += highCard / 14 * 0.3;
            
            // Pair possibility
            const ranks = cards.map(c => c.rank);
            const uniqueRanks = new Set(ranks);
            const pairCount = ranks.length - uniqueRanks.size;
            strength += (pairCount * 0.2);
            
            // Suited cards
            if (player.cards.length === 2) {
                if (player.cards[0].suit === player.cards[1].suit) {
                    strength += 0.1;
                }
                
                // Connected cards
                const cardDiff = Math.abs(player.cards[0].value - player.cards[1].value);
                if (cardDiff <= 2) {
                    strength += 0.1;
                }
            }
            
            return Math.min(strength, 1);
        }

        // ===== SHOWDOWN =====
        async function showdown() {
            showGameState('Showdown! Determining winner...');
            
            // Calculate rake
            const rake = Math.min(
                pokerGame.gameState.pot * pokerGame.gameConfig.rakePercentage,
                pokerGame.gameConfig.maxRake
            );
            pokerGame.gameState.rake = rake;
            
            // Determine winner based on 10% win rate for human
            const humanPlayer = pokerGame.gameState.players.find(p => p.id === pokerGame.playerId);
            const humanWins = Math.random() < pokerGame.gameConfig.winRate;
            
            let winners = [];
            
            if (humanWins && humanPlayer && !humanPlayer.isFolded) {
                // Human wins
                winners = [humanPlayer];
                pokerGame.session.handsWon++;
                pokerGame.session.netProfit += pokerGame.gameState.pot - rake;
                
                // Update balance (simulated)
                await processWin(humanPlayer, pokerGame.gameState.pot - rake);
                
                showToast(`${humanPlayer.name} WINS $${pokerGame.gameState.pot - rake}!`, 'success');
                logGameEvent('win', `Won $${pokerGame.gameState.pot - rake} (rake: $${rake})`);
                playSound('win');
                
                // Animate win
                animatePotWin(0);
                
            } else {
                // AI wins (random AI that hasn't folded)
                const activeAIPlayers = pokerGame.gameState.players.filter(p => 
                    p.isAI && !p.isFolded && p.isActive
                );
                
                if (activeAIPlayers.length > 0) {
                    const winner = activeAIPlayers[Math.floor(Math.random() * activeAIPlayers.length)];
                    winners = [winner];
                    
                    // Update session stats for human loss
                    pokerGame.session.netProfit -= (humanPlayer?.currentBet || 0);
                    
                    showToast(`${winner.name} wins the pot!`, 'info');
                    logGameEvent('loss', `Lost $${humanPlayer?.currentBet || 0}`);
                    playSound('lose');
                    
                    // Animate loss
                    document.getElementById(`seat0`).classList.add('loss-fade');
                    setTimeout(() => {
                        document.getElementById(`seat0`).classList.remove('loss-fade');
                    }, 2000);
                }
            }
            
            // Record winner for leaderboard
            if (winners.length > 0) {
                const winner = winners[0];
                await recordWin(winner.name, pokerGame.gameState.pot - rake);
            }
            
            // Reveal all cards
            await revealAllCards();
            
            // Update displays
            updateAllDisplays();
            updateMobileStats();
            updateSessionDisplay();
            
            // Show result
            await sleep(3000);
            hideGameState();
            
            // Start new hand after delay
            setTimeout(() => {
                if (humanPlayer?.stack > 0) {
                    startNewHand();
                } else {
                    showToast('You are out of chips!', 'warning');
                    endSession();
                }
            }, 2000);
        }

        async function processWin(player, amount) {
            try {
                // Simulate balance update
                await new Promise(resolve => setTimeout(resolve, 6000)); // 6-second delay
                pokerGame.balance += amount;
                player.stack += amount;
                updateBalanceDisplay();
                
                // Record transaction
                await recordTransaction('win', amount, pokerGame.gameId);
                
            } catch (error) {
                console.error('Process win error:', error);
                showToast('Error processing win', 'error');
            }
        }

        async function recordTransaction(type, amount, gameId) {
            try {
                await db.collection('poker_transactions').add({
                    playerId: pokerGame.playerId,
                    playerName: pokerGame.playerProfile?.name,
                    type: type,
                    amount: amount,
                    gameId: gameId,
                    timestamp: new Date(),
                    balanceBefore: pokerGame.balance - amount,
                    balanceAfter: pokerGame.balance
                });
            } catch (error) {
                console.error('Record transaction error:', error);
            }
        }

        async function recordWin(playerName, amount) {
            try {
                await db.collection('poker_wins').add({
                    player: playerName,
                    amount: amount,
                    timestamp: new Date(),
                    gameId: pokerGame.gameId
                });
                
                // Update local winners list
                pokerGame.recentWinners.unshift({
                    player: playerName,
                    amount: amount,
                    timestamp: new Date()
                });
                
                if (pokerGame.recentWinners.length > 10) {
                    pokerGame.recentWinners.pop();
                }
                
                updateWinnersDisplay();
            } catch (error) {
                console.error('Record win error:', error);
            }
        }

        // ===== UI UPDATES =====
        function updateAllDisplays() {
            updatePlayerDisplays();
            updateCommunityCardsDisplay();
            updatePotDisplay();
            updateRoundDisplay();
            updateSessionDisplay();
        }

        function updatePlayerDisplays() {
            pokerGame.gameState.players.forEach((player, index) => {
                const seat = document.getElementById(`seat${index}`);
                const nameElement = document.getElementById(`seat${index}Name`);
                const stackElement = document.getElementById(`seat${index}Stack`);
                const cardsElement = document.getElementById(`seat${index}Cards`);
                const statusElement = document.getElementById(`seat${index}Status`);
                
                if (!seat || !nameElement || !stackElement) return;
                
                // Update basic info
                nameElement.textContent = player.name;
                stackElement.textContent = `$${player.stack}`;
                
                // Update seat styling
                seat.classList.remove('active', 'dealer', 'folded', 'allin');
                
                if (pokerGame.gameState.currentPlayer === player.id) {
                    seat.classList.add('active');
                }
                
                if (index === pokerGame.gameState.dealerPosition) {
                    seat.classList.add('dealer');
                }
                
                if (player.isFolded) {
                    seat.classList.add('folded');
                }
                
                if (player.isAllIn) {
                    seat.classList.add('allin');
                }
                
                // Update cards
                if (cardsElement) {
                    cardsElement.innerHTML = '';
                    player.cards.forEach(card => {
                        const cardElement = createCardElement(card, !player.isAI || pokerGame.gameState.status === 'showdown');
                        cardsElement.appendChild(cardElement);
                    });
                }
                
                // Update status
                if (statusElement) {
                    statusElement.className = 'player-status';
                    statusElement.textContent = '';
                    
                    if (player.isFolded) {
                        statusElement.classList.add('folded');
                        statusElement.textContent = 'Folded';
                    } else if (player.isAllIn) {
                        statusElement.classList.add('allin');
                        statusElement.textContent = 'All-In';
                    } else if (player.currentBet > 0) {
                        statusElement.classList.add('bet');
                        statusElement.textContent = `Bet: $${player.currentBet}`;
                    }
                }
            });
        }

        function updateCommunityCardsDisplay() {
            const container = document.getElementById('communityCards');
            if (!container) return;
            
            container.innerHTML = '';
            
            pokerGame.gameState.communityCards.forEach(card => {
                const cardElement = createCardElement(card, true);
                container.appendChild(cardElement);
            });
            
            // Add placeholders for remaining cards
            const remaining = 5 - pokerGame.gameState.communityCards.length;
            for (let i = 0; i < remaining; i++) {
                const placeholder = document.createElement('div');
                placeholder.className = 'card back';
                placeholder.innerHTML = '?';
                container.appendChild(placeholder);
            }
        }

        function updatePotDisplay() {
            const element = document.getElementById('potDisplay');
            if (element) {
                element.textContent = `Pot: $${pokerGame.gameState.pot}`;
            }
        }

        function updateRoundDisplay() {
            const element = document.getElementById('roundDisplay');
            if (element) {
                element.textContent = pokerGame.gameState.round.charAt(0).toUpperCase() + 
                                     pokerGame.gameState.round.slice(1).replace('flop', 'Flop');
            }
        }

        function updateSessionDisplay() {
            document.getElementById('totalHands').textContent = pokerGame.session.handsPlayed;
            document.getElementById('netProfit').textContent = `$${pokerGame.session.netProfit}`;
            document.getElementById('currentBet').textContent = `$${pokerGame.gameState.currentBet}`;
            
            // Update mobile stats
            updateMobileStats();
        }

        function updateMobileStats() {
            document.getElementById('mobileTotalHands').textContent = pokerGame.session.handsPlayed;
            document.getElementById('mobileHandsWon').textContent = pokerGame.session.handsWon;
            document.getElementById('mobileNetProfit').textContent = `$${pokerGame.session.netProfit}`;
            document.getElementById('mobileCurrentPot').textContent = `$${pokerGame.gameState.pot}`;
            
            const humanPlayer = pokerGame.gameState.players.find(p => p.id === pokerGame.playerId);
            const toCall = humanPlayer ? getCallAmount(humanPlayer) : 0;
            document.getElementById('mobileToCall').textContent = `$${toCall}`;
            
            // Update mobile history
            updateMobileHistory();
        }

        function updateMobileHistory() {
            const container = document.getElementById('mobileHistoryList');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Show last 5 hands
            const recentHands = pokerGame.gameHistory.slice(0, 5);
            recentHands.forEach(record => {
                const item = document.createElement('div');
                item.className = `history-item ${record.result || 'info'}`;
                
                const time = record.timestamp?.toDate ? 
                    formatTime(record.timestamp.toDate()) : 
                    formatTime(new Date());
                
                item.innerHTML = `
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-size: 11px; overflow: hidden; text-overflow: ellipsis;">${record.message || 'Poker Hand'}</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="history-amount ${record.result || 'info'}" style="font-size: 12px;">
                            ${record.amount ? (record.result === 'win' ? '+' : '') + `$${Math.abs(record.amount)}` : ''}
                        </div>
                        <div class="history-time">${time}</div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function createCardElement(card, showFront = true) {
            const div = document.createElement('div');
            
            if (showFront && card) {
                div.className = `card ${card.color} card-deal`;
                div.innerHTML = `
                    <div class="card-corner card-corner-top">${card.rank}</div>
                    <div class="card-center">${card.suit}</div>
                    <div class="card-corner card-corner-bottom">${card.rank}</div>
                `;
            } else {
                div.className = 'card back';
            }
            
            return div;
        }

        // ===== ANIMATIONS =====
        function animateCardDeal(playerPosition) {
            const seat = document.getElementById(`seat${playerPosition}`);
            if (seat) {
                const cards = seat.querySelector('.player-cards');
                if (cards) {
                    cards.classList.add('card-deal');
                    setTimeout(() => cards.classList.remove('card-deal'), 600);
                }
            }
        }

        function animateCommunityCard() {
            const container = document.getElementById('communityCards');
            if (container) {
                const lastCard = container.lastElementChild;
                if (lastCard) {
                    lastCard.classList.add('card-deal');
                }
            }
        }

        function animatePotWin(winnerPosition) {
            const potDisplay = document.getElementById('potDisplay');
            if (potDisplay) {
                potDisplay.classList.add('win-glow');
                setTimeout(() => potDisplay.classList.remove('win-glow'), 3000);
            }
            
            const winnerSeat = document.getElementById(`seat${winnerPosition}`);
            if (winnerSeat) {
                winnerSeat.classList.add('win-glow');
                setTimeout(() => winnerSeat.classList.remove('win-glow'), 3000);
            }
        }

        async function revealAllCards() {
            // Reveal all player cards
            pokerGame.gameState.players.forEach((player, index) => {
                const cardsElement = document.getElementById(`seat${index}Cards`);
                if (cardsElement) {
                    cardsElement.innerHTML = '';
                    player.cards.forEach(card => {
                        const cardElement = createCardElement(card, true);
                        cardsElement.appendChild(cardElement);
                    });
                }
            });
        }

        // ===== SOUND SYSTEM =====
        function playSound(soundType) {
            if (!pokerGame.soundEnabled) return;
            
            const audioMap = {
                'cardDeal': document.getElementById('soundCardDeal'),
                'chip': document.getElementById('soundChip'),
                'win': document.getElementById('soundWin'),
                'lose': document.getElementById('soundLose'),
                'fold': document.getElementById('soundFold'),
                'bet': document.getElementById('soundBet')
            };
            
            const audio = audioMap[soundType];
            if (audio) {
                audio.currentTime = 0;
                audio.play().catch(e => console.log('Audio play failed:', e));
            }
        }

        // ===== GAME HISTORY =====
        async function loadGameHistory() {
            try {
                const snapshot = await db.collection('poker_history')
                    .where('playerId', '==', pokerGame.currentUser.uid)
                    .orderBy('timestamp', 'desc')
                    .limit(20)
                    .get();
                
                pokerGame.gameHistory = [];
                snapshot.forEach(doc => {
                    pokerGame.gameHistory.push({ id: doc.id, ...doc.data() });
                });
                updateHistoryDisplay();
            } catch (error) {
                console.error('Error loading history:', error);
            }
        }

        function updateHistoryDisplay() {
            const container = document.getElementById('historyList');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (pokerGame.gameHistory.length === 0) {
                container.innerHTML = '<div class="history-item">No games played yet</div>';
                return;
            }
            
            pokerGame.gameHistory.forEach(record => {
                const item = document.createElement('div');
                item.className = `history-item ${record.result}`;
                
                const time = record.timestamp?.toDate ? 
                    formatTime(record.timestamp.toDate()) : 
                    formatTime(new Date());
                
                item.innerHTML = `
                    <div>
                        <div>${record.description || 'Poker Hand'}</div>
                        <div style="font-size: 11px; color: var(--text-secondary);">${record.handId || ''}</div>
                    </div>
                    <div>
                        <span class="history-amount ${record.result}">
                            ${record.result === 'win' ? '+' : ''}$${Math.abs(record.amount || 0)}
                        </span>
                        <div class="history-time">${time}</div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // ===== RECENT WINNERS =====
        async function loadRecentWinners() {
            try {
                const tenDaysAgo = new Date();
                tenDaysAgo.setDate(tenDaysAgo.getDate() - 10);
                
                const snapshot = await db.collection('poker_wins')
                    .where('timestamp', '>=', tenDaysAgo)
                    .orderBy('timestamp', 'desc')
                    .limit(10)
                    .get();
                
                pokerGame.recentWinners = [];
                snapshot.forEach(doc => {
                    pokerGame.recentWinners.push(doc.data());
                });
                updateWinnersDisplay();
            } catch (error) {
                console.error('Error loading winners:', error);
            }
        }

        function updateWinnersDisplay() {
            // Desktop winners
            const desktopContainer = document.getElementById('winnersList');
            const mobileContainer = document.getElementById('mobileWinnersList');
            
            [desktopContainer, mobileContainer].forEach(container => {
                if (!container) return;
                
                container.innerHTML = '';
                
                if (pokerGame.recentWinners.length === 0) {
                    container.innerHTML = '<div class="winner-item"><span>No recent winners</span></div>';
                    return;
                }
                
                pokerGame.recentWinners.forEach(winner => {
                    const item = document.createElement('div');
                    item.className = 'winner-item';
                    item.innerHTML = `
                        <span class="winner-name">${winner.player}</span>
                        <span class="winner-amount">$${winner.amount}</span>
                    `;
                    container.appendChild(item);
                });
            });
        }

        // ===== SESSION MANAGEMENT =====
        function startSessionTimer() {
            pokerGame.session.startTime = new Date();
            setInterval(() => {
                if (pokerGame.session.startTime) {
                    const elapsed = Math.floor((new Date() - pokerGame.session.startTime) / 1000);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = elapsed % 60;
                    document.getElementById('sessionTime').textContent = 
                        `${minutes}m ${seconds}s`;
                    document.getElementById('mobileSessionTime').textContent = 
                        `${minutes}m ${seconds}s`;
                }
            }, 1000);
        }

        async function getDailyStats() {
            try {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const snapshot = await db.collection('poker_sessions')
                    .where('playerId', '==', pokerGame.playerId)
                    .where('date', '>=', today)
                    .get();
                
                let handsPlayed = 0;
                let dailyLoss = 0;
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    handsPlayed += data.handsPlayed || 0;
                    if (data.netProfit < 0) {
                        dailyLoss += Math.abs(data.netProfit);
                    }
                });
                
                return { handsPlayed, dailyLoss };
            } catch (error) {
                console.error('Error getting daily stats:', error);
                return { handsPlayed: 0, dailyLoss: 0 };
            }
        }

        async function endSession() {
            try {
                // Record session
                await db.collection('poker_sessions').add({
                    playerId: pokerGame.playerId,
                    playerName: pokerGame.playerProfile?.name,
                    startTime: pokerGame.session.startTime,
                    endTime: new Date(),
                    handsPlayed: pokerGame.session.handsPlayed,
                    handsWon: pokerGame.session.handsWon,
                    netProfit: pokerGame.session.netProfit,
                    date: new Date()
                });
                
                showToast('Session ended', 'info');
                logGameEvent('session_end', `Session ended: ${pokerGame.session.handsPlayed} hands, $${pokerGame.session.netProfit} profit`);
                
                // Reset session
                pokerGame.session = {
                    startTime: null,
                    handsPlayed: 0,
                    handsWon: 0,
                    netProfit: 0,
                    dailyLimit: 100,
                    dailyLossLimit: 1000,
                    lastActionTime: null
                };
                
                // Hide action controls
                document.getElementById('desktopActionControls')?.classList.remove('active');
                document.getElementById('mobileActionControls')?.classList.remove('active');
                
                // Reset UI
                updateAllDisplays();
                updateMobileStats();
                
            } catch (error) {
                console.error('Error ending session:', error);
            }
        }

        // ===== EVENT LOGGING =====
        function logGameEvent(type, message) {
            console.log(`[Poker] ${type}: ${message}`);
            
            // Add to game history
            const timestamp = new Date();
            const record = {
                timestamp: timestamp,
                type: type,
                message: message,
                result: type === 'win' ? 'win' : type === 'loss' ? 'loss' : 'info'
            };
            
            pokerGame.gameHistory.unshift(record);
            
            if (pokerGame.gameHistory.length > 20) {
                pokerGame.gameHistory.pop();
            }
            
            updateHistoryDisplay();
        }

        function logGameAction(player, action, amount) {
            logGameEvent('action', `${player.name} ${action}${amount > 0 ? ` $${amount}` : ''}`);
        }

        // ===== UTILITY FUNCTIONS =====
        function createDeck() {
            const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
            const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            const deck = [];
            
            for (const suit of suits) {
                for (const rank of ranks) {
                    deck.push({
                        rank,
                        suit,
                        color: suit === '‚ô•' || suit === '‚ô¶' ? 'red' : 'black',
                        value: getCardValue(rank)
                    });
                }
            }
            
            return shuffleDeck(deck);
        }

        function shuffleDeck(deck) {
            // Fisher-Yates shuffle
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }

        function getCardValue(rank) {
            const values = {
                '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10,
                'J': 11, 'Q': 12, 'K': 13, 'A': 14
            };
            return values[rank] || 0;
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <i class="fas ${icons[type] || 'fa-info-circle'}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (container.contains(toast)) {
                        container.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        function showGameState(message) {
            const overlay = document.getElementById('gameStateOverlay');
            const messageElement = document.getElementById('stateMessage');
            
            if (overlay && messageElement) {
                messageElement.innerHTML = `
                    <h3>${message}</h3>
                    <p>Please wait...</p>
                    <div class="spinner"></div>
                `;
                overlay.style.display = 'flex';
            }
        }

        function hideGameState() {
            const overlay = document.getElementById('gameStateOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function formatTime(date) {
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // ===== CONNECTION MONITORING =====
        function setupConnectionMonitoring() {
            // Monitor Firebase connection
            db.enableNetwork()
                .then(() => {
                    pokerGame.connectionStatus = 'connected';
                    updateConnectionStatus();
                })
                .catch(error => {
                    pokerGame.connectionStatus = 'disconnected';
                    updateConnectionStatus();
                });

            // Network status listener
            window.addEventListener('online', () => {
                pokerGame.connectionStatus = 'connected';
                updateConnectionStatus();
                showToast('Connection restored', 'success');
            });

            window.addEventListener('offline', () => {
                pokerGame.connectionStatus = 'disconnected';
                updateConnectionStatus();
                showToast('Connection lost', 'error');
            });
        }

        function updateConnectionStatus() {
            const element = document.getElementById('connectionStatus');
            if (element) {
                element.className = `connection-status status-${pokerGame.connectionStatus}`;
                element.innerHTML = `
                    <i class="fas fa-${pokerGame.connectionStatus === 'connected' ? 'wifi' : 'exclamation-triangle'}"></i>
                    <span>${pokerGame.connectionStatus === 'connected' ? 'Connected' : 'Disconnected'}</span>
                `;
            }
        }

        // ===== PUBLIC FUNCTIONS =====
        window.closeMobileSidebar = closeMobileSidebar;
        window.closeMobileStats = closeMobileStats;
    </script>
</body>
</html>
