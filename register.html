<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-BET PRO | Register</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #3b82f6; --bg: #020617; --card: rgba(30, 41, 59, 0.7); }
        body { 
            background: radial-gradient(circle at top right, #1e3a8a, var(--bg)); 
            color: white; font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh;
        }
        .auth-card { 
            background: var(--card); backdrop-filter: blur(12px); padding: 40px; 
            border-radius: 24px; border: 1px solid rgba(255,255,255,0.1); 
            width: 100%; max-width: 400px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        h2 { margin: 0 0 10px; text-align: center; }
        p { color: #94a3b8; text-align: center; margin-bottom: 30px; }
        .input-group { margin-bottom: 15px; }
        input { 
            width: 100%; padding: 14px; background: #0f172a; border: 2px solid #334155; 
            color: white; border-radius: 10px; box-sizing: border-box; font-size: 1rem;
        }
        input:focus { outline: none; border-color: var(--accent); }
        .btn-submit { 
            width: 100%; padding: 16px; background: var(--accent); color: white; 
            border: none; border-radius: 10px; font-weight: 700; cursor: pointer; font-size: 1rem;
        }
        .btn-submit:disabled { opacity: 0.5; cursor: not-allowed; }
        #statusMsg { margin-top: 20px; text-align: center; font-size: 0.9rem; min-height: 20px; }
        .error { color: #ef4444; }
        .success { color: #22c55e; }
        a { color: var(--accent); text-decoration: none; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="auth-card">
    <h2>Join X-BET PRO</h2>
    <p>Get your $1,000 welcome bonus</p>

    <form id="registerForm">
        <div class="input-group">
            <input type="email" id="email" placeholder="Email Address" required autocomplete="email">
        </div>
        <div class="input-group">
            <input type="password" id="password" placeholder="Password (8+ chars)" required autocomplete="new-password">
        </div>
        <div class="input-group">
            <input type="password" id="confirmPassword" placeholder="Confirm Password" required autocomplete="new-password">
        </div>
        <button type="submit" id="submitBtn" class="btn-submit">Register & Claim Bonus</button>
    </form>

    <div id="statusMsg"></div>
    <div style="text-align: center; margin-top: 20px;">
        <a href="login.html">Already have an account? Login</a>
    </div>
</div>

<script type="module">
    // Direct Cloud Import (No local files needed)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, deleteUser } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Your Verified Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyA72Yo_YGqno9PX25p3yQBvyflcaM-NqEM",
        authDomain: "x-bet-prod-jd.firebaseapp.com",
        projectId: "x-bet-prod-jd",
        storageBucket: "x-bet-prod-jd.firebasestorage.app",
        messagingSenderId: "499334334535",
        appId: "1:499334334535:web:bebc1bf817e24d9e3c4962",
        measurementId: "G-PTV4XMYQ6P"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const form = document.getElementById('registerForm');
    const status = document.getElementById('statusMsg');
    const btn = document.getElementById('submitBtn');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const email = document.getElementById('email').value.trim().toLowerCase();
        const pass = document.getElementById('password').value;
        const confirm = document.getElementById('confirmPassword').value;

        // Reset Status
        status.innerText = "";
        
        // Front-end Validation
        if (pass.length < 8) {
            updateStatus("Password must be at least 8 characters.", "error");
            return;
        }
        if (pass !== confirm) {
            updateStatus("Passwords do not match.", "error");
            return;
        }

        // Lock UI
        btn.disabled = true;
        btn.innerText = "Processing...";
        updateStatus("Securing your account...", "success");

        let userRecord = null;

        try {
            // 1. Create User in Auth
            const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
            userRecord = userCredential.user;

            // 2. Create Wallet in Firestore
            const walletRef = doc(db, "wallets", userRecord.uid);
            await setDoc(walletRef, {
                profile: { 
                    email: email, 
                    createdAt: serverTimestamp() 
                },
                wallet: { 
                    balance: 1000, 
                    currency: "USD" 
                },
                metadata: { 
                    lastLogin: serverTimestamp(),
                    isActive: true
                }
            });

            updateStatus("Registration successful! $1,000 added.", "success");
            
            // Redirect to Dashboard after a short delay
            setTimeout(() => {
                window.location.href = 'dashboard.html';
            }, 1500);

        } catch (error) {
            // Clean up Auth user if Database fails
            if (userRecord && userRecord.uid) {
                await deleteUser(userRecord).catch(() => {});
            }
            
            console.error("Firebase Error:", error.code);
            updateStatus(formatError(error.code), "error");
            btn.disabled = false;
            btn.innerText = "Register & Claim Bonus";
        }
    });

    function updateStatus(msg, type) {
        status.innerText = msg;
        status.className = type;
    }

    function formatError(code) {
        switch(code) {
            case 'auth/email-already-in-use': return "Email already registered.";
            case 'auth/invalid-email': return "Invalid email format.";
            case 'auth/weak-password': return "Password is too weak.";
            default: return "Registration failed. Please try again.";
        }
    }
</script>

</body>
</html>
