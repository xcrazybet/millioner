<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>X-BET PRO | Register</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700&display=swap" rel="stylesheet">
<style>
    :root { --accent: #3b82f6; --bg: #020617; --card: rgba(30,41,59,0.8); }
    body {
        background: radial-gradient(circle at top right, #1e3a8a, var(--bg));
        color: white; font-family: 'Plus Jakarta Sans', sans-serif;
        margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh;
    }
    .card {
        background: var(--card); backdrop-filter: blur(12px); padding: 40px;
        border-radius: 24px; border: 1px solid rgba(255,255,255,0.1);
        width: 100%; max-width: 400px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    }
    h2 { text-align: center; margin-bottom: 10px; }
    p { text-align: center; color: #94a3b8; margin-bottom: 30px; }
    .input-group { margin-bottom: 15px; }
    input {
        width: 100%; padding: 14px; background: #0f172a; border: 2px solid #334155;
        color: white; border-radius: 10px; font-size: 1rem; box-sizing: border-box;
    }
    input:focus { outline: none; border-color: var(--accent); }
    .btn { width: 100%; padding: 16px; background: var(--accent); border: none;
        color: white; border-radius: 10px; font-weight: 700; cursor: pointer; font-size: 1rem;
    }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    #status { margin-top: 20px; text-align: center; font-size: 0.9rem; min-height: 20px; }
    .error { color: #ef4444; }
    .success { color: #22c55e; }
    a { color: var(--accent); text-decoration: none; font-size: 0.9rem; display: block; text-align: center; margin-top: 20px; }
</style>
</head>
<body>

<div class="card">
    <h2>Join X-BET PRO</h2>
    <p>Start with $0.00 and track your profits!</p>

    <form id="registerForm">
        <div class="input-group">
            <input type="email" id="email" placeholder="Email Address" required autocomplete="email">
        </div>
        <div class="input-group">
            <input type="password" id="password" placeholder="Password (8+ chars)" required autocomplete="new-password">
        </div>
        <div class="input-group">
            <input type="password" id="confirmPassword" placeholder="Confirm Password" required autocomplete="new-password">
        </div>
        <button type="submit" id="btnRegister" class="btn">Register Now</button>
    </form>

    <div id="status"></div>
    <a href="login.html">Already have an account? Login</a>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, deleteUser } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ✅ Firebase Config
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT_ID.appspot.com",
        messagingSenderId: "YOUR_ID",
        appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const form = document.getElementById('registerForm');
    const status = document.getElementById('status');
    const btn = document.getElementById('btnRegister');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value.trim().toLowerCase();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        // Reset status
        status.innerText = "";
        status.className = "";

        if(password.length < 8){ showStatus("Password must be at least 8 characters.","error"); return; }
        if(password !== confirmPassword){ showStatus("Passwords do not match.","error"); return; }

        btn.disabled = true;
        btn.innerText = "Processing...";
        showStatus("Creating your account...","success");

        let userRecord = null;

        try{
            // 1️⃣ Create Auth User
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            userRecord = userCredential.user;

            // 2️⃣ Create Firestore User Wallet with zero balance
            const walletRef = doc(db,"wallets",userRecord.uid);
            const uniqueCode = "XBET" + Math.random().toString(36).substring(2,10).toUpperCase(); // Unique user code

            await setDoc(walletRef,{
                profile: {
                    email: email,
                    createdAt: serverTimestamp(),
                    uniqueCode: uniqueCode
                },
                wallet: {
                    balance: 0,
                    currency: "USD"
                },
                metadata:{
                    lastLogin: serverTimestamp(),
                    isActive: true
                }
            });

            // ✅ Successful registration
            showStatus("Registration successful! Redirecting to your dashboard...","success");
            
            setTimeout(()=>{
                window.location.href = 'dashboard.html';
            },1500);

        } catch(error){
            // Rollback auth if db fails
            if(userRecord && userRecord.uid){ await deleteUser(userRecord).catch(()=>{}); }

            console.error("Firebase Error:",error.code);
            showStatus(formatError(error.code),"error");
            btn.disabled = false;
            btn.innerText = "Register Now";
        }
    });

    function showStatus(msg,type){
        status.innerText = msg;
        status.className = type;
    }

    function formatError(code){
        switch(code){
            case 'auth/email-already-in-use': return "Email is already registered.";
            case 'auth/invalid-email': return "Invalid email format.";
            case 'auth/weak-password': return "Password is too weak.";
            default: return "Registration failed. Please try again.";
        }
    }
</script>
</body>
</html>
