<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>♠️ Elite Poker - XCrazyBet</title>
    
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --primary: #ff3b5c;
            --primary-dark: #d81b3a;
            --secondary: #00b894;
            --accent: #0984e3;
            --danger: #ff5252;
            --warning: #fdcb6e;
            --success: #00cec9;
            --dark-bg: #0f172a;
            --medium-bg: #1e293b;
            --light-bg: #334155;
            --text: #f8fafc;
            --text-secondary: #94a3b8;
            --chip-1: #ff3b5c;
            --chip-5: #0984e3;
            --chip-10: #00b894;
            --chip-25: #fdcb6e;
            --chip-100: #a855f7;
            --table-green: #0d4d30;
            --table-border: #8b4513;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, var(--dark-bg), #1a237e);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        /* Mobile Optimized Container */
        .mobile-container {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            padding: 10px;
        }

        /* Header - Mobile Optimized */
        .header {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(31, 41, 55, 0.9));
            padding: 15px 20px;
            border-bottom: 3px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .logo-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
            font-weight: 800;
        }

        .logo i {
            color: var(--primary);
            font-size: 24px;
        }

        .balance-display {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            padding: 10px 15px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(255, 59, 92, 0.3);
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Mobile Tabs */
        .mobile-tabs {
            display: flex;
            gap: 5px;
            width: 100%;
            overflow-x: auto;
            padding-bottom: 5px;
            scrollbar-width: none;
        }

        .mobile-tabs::-webkit-scrollbar {
            display: none;
        }

        .tab-btn {
            flex: 1;
            min-width: 80px;
            padding: 10px;
            background: var(--medium-bg);
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Game Tab */
        .game-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        /* Poker Table - Mobile Optimized */
        .poker-table {
            position: relative;
            background: radial-gradient(circle at center, var(--table-green) 0%, #0a4228 70%, #052917 100%);
            border: 12px solid var(--table-border);
            border-radius: 50%;
            width: 100%;
            height: 350px;
            margin: 0 auto;
            box-shadow: 
                inset 0 0 40px rgba(0, 0, 0, 0.7),
                0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        .table-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            height: 60%;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 20px;
        }

        .pot-display {
            font-size: 20px;
            font-weight: 800;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            text-align: center;
        }

        .community-cards {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Player Seats - Mobile Optimized */
        .player-seat {
            position: absolute;
            width: 85px;
            height: 100px;
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.9), rgba(30, 41, 59, 0.9));
            border-radius: 10px;
            border: 2px solid var(--accent);
            padding: 10px;
            text-align: center;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .player-seat.active {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            transform: scale(1.05);
            z-index: 100;
        }

        .player-seat.dealer::after {
            content: "D";
            position: absolute;
            top: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .player-name {
            font-size: 12px;
            font-weight: 700;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 5px;
            border-radius: 4px;
        }

        .player-stack {
            font-size: 11px;
            font-weight: 700;
            color: var(--success);
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 5px;
            border-radius: 4px;
        }

        .player-cards {
            display: flex;
            justify-content: center;
            gap: 3px;
            margin: 5px 0;
        }

        .player-bet {
            font-size: 10px;
            color: var(--warning);
            font-weight: 600;
        }

        /* Card Styles - Mobile Optimized */
        .card {
            width: 30px;
            height: 42px;
            background: white;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 14px;
            color: black;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .card.red {
            color: #d50000;
        }

        .card.black {
            color: #000;
        }

        .card.back {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            font-size: 8px;
        }

        .card-rank {
            position: absolute;
            top: 3px;
            left: 3px;
            font-size: 12px;
        }

        .card-suit {
            font-size: 16px;
        }

        /* Action Controls - Mobile Optimized */
        .action-controls {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid var(--primary);
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .action-btn {
            padding: 12px 5px;
            border: none;
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            min-height: 60px;
        }

        .action-btn i {
            font-size: 18px;
        }

        .action-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none !important;
        }

        .action-btn:active:not(:disabled) {
            transform: scale(0.95);
        }

        .btn-fold {
            background: linear-gradient(135deg, var(--danger), #c0392b);
            color: white;
        }

        .btn-check {
            background: linear-gradient(135deg, var(--text-secondary), #7f8c8d);
            color: white;
        }

        .btn-call {
            background: linear-gradient(135deg, var(--accent), #2980b9);
            color: white;
        }

        .btn-raise {
            background: linear-gradient(135deg, var(--warning), #f39c12);
            color: #2d3436;
        }

        .btn-allin {
            background: linear-gradient(135deg, var(--primary), #e74c3c);
            color: white;
            grid-column: span 3;
        }

        .bet-controls {
            grid-column: span 3;
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .bet-input-group {
            display: flex;
            gap: 10px;
        }

        .bet-input {
            flex: 1;
            padding: 15px;
            background: var(--medium-bg);
            border: 2px solid var(--primary);
            border-radius: 10px;
            color: var(--text);
            font-size: 18px;
            font-weight: 700;
            text-align: center;
        }

        .chip-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .chip {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid white;
            font-size: 12px;
            margin: 0 auto;
        }

        .chip:active {
            transform: scale(0.9);
        }

        .chip-1 { background: var(--chip-1); }
        .chip-5 { background: var(--chip-5); }
        .chip-10 { background: var(--chip-10); }
        .chip-25 { background: var(--chip-25); }
        .chip-100 { background: var(--chip-100); }

        /* Game Info */
        .game-info {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid var(--accent);
            margin-top: 15px;
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .stat-box {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 800;
            color: var(--primary);
        }

        /* Rules Tab */
        .rules-container {
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            margin-top: 15px;
        }

        .rules-section {
            margin-bottom: 25px;
        }

        .rules-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rules-section p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .hand-ranks {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .hand-rank {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .hand-name {
            color: var(--primary);
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .hand-example {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* Players Tab */
        .players-container {
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            margin-top: 15px;
        }

        .players-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .player-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: all 0.3s;
        }

        .player-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
        }

        .player-details h4 {
            font-size: 16px;
            font-weight: 700;
        }

        .player-details p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .player-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 600;
        }

        .status-winning {
            background: rgba(0, 206, 201, 0.2);
            color: var(--success);
        }

        .status-losing {
            background: rgba(255, 82, 82, 0.2);
            color: var(--danger);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes chipThrow {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-30px) rotate(180deg); }
            100% { transform: translateY(0) rotate(360deg); }
        }

        @keyframes cardDeal {
            0% { transform: translateY(-50px) rotateY(0deg); opacity: 0; }
            100% { transform: translateY(0) rotateY(360deg); opacity: 1; }
        }

        @keyframes winPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .chip-animation {
            animation: chipThrow 0.6s ease-out;
        }

        .card-deal {
            animation: cardDeal 0.4s ease-out;
        }

        .win-animation {
            animation: winPulse 1s infinite;
        }

        .shake-animation {
            animation: shake 0.5s ease-in-out;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 300px;
        }

        .toast {
            padding: 15px 20px;
            border-radius: 10px;
            background: rgba(30, 41, 59, 0.95);
            border-left: 4px solid var(--primary);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--danger); }
        .toast.warning { border-color: var(--warning); }
        .toast.info { border-color: var(--accent); }

        /* Responsive Adjustments */
        @media (max-width: 380px) {
            .player-seat {
                width: 75px;
                height: 90px;
                padding: 8px;
            }
            
            .card {
                width: 25px;
                height: 35px;
                font-size: 12px;
            }
            
            .action-btn {
                padding: 10px 5px;
                font-size: 12px;
            }
            
            .chip {
                width: 40px;
                height: 40px;
                font-size: 11px;
            }
        }

        @media (min-width: 481px) {
            .mobile-container {
                max-width: 95%;
            }
            
            .poker-table {
                height: 400px;
            }
            
            .player-seat {
                width: 100px;
                height: 120px;
            }
            
            .card {
                width: 35px;
                height: 49px;
            }
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Sound Toggle */
        .sound-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(255, 59, 92, 0.3);
            transition: all 0.3s;
        }

        .sound-toggle:active {
            transform: scale(0.9);
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div style="font-size: 18px; font-weight: 600; color: var(--primary);">
            Loading Poker Table...
        </div>
    </div>

    <!-- Sound Toggle -->
    <div class="sound-toggle" id="soundToggle">
        <i class="fas fa-volume-up"></i>
    </div>

    <!-- Mobile Container -->
    <div class="mobile-container">
        <!-- Header -->
        <header class="header">
            <div class="logo-container">
                <div class="logo">
                    <i class="fas fa-diamond"></i>
                    Elite Poker
                </div>
                <div class="balance-display" id="balanceDisplay">
                    <i class="fas fa-coins"></i> $0.00
                </div>
            </div>
            
            <!-- Mobile Tabs -->
            <div class="mobile-tabs">
                <button class="tab-btn active" data-tab="game">
                    <i class="fas fa-gamepad"></i> Game
                </button>
                <button class="tab-btn" data-tab="rules">
                    <i class="fas fa-book"></i> Rules
                </button>
                <button class="tab-btn" data-tab="players">
                    <i class="fas fa-users"></i> Players
                </button>
            </div>
        </header>

        <!-- Game Tab -->
        <div class="tab-content active" id="gameTab">
            <div class="game-container">
                <!-- Poker Table -->
                <div class="poker-table" id="pokerTable">
                    <!-- Community Cards -->
                    <div class="table-center">
                        <div class="pot-display" id="potDisplay">Pot: $0</div>
                        <div class="community-cards" id="communityCards">
                            <!-- Cards will be added here -->
                        </div>
                    </div>
                    
                    <!-- Player Seats (3 Players) -->
                    <div class="player-seat" id="seat0" style="top: 10%; left: 50%; transform: translateX(-50%);">
                        <div class="player-name">You</div>
                        <div class="player-cards">
                            <div class="card back"></div>
                            <div class="card back"></div>
                        </div>
                        <div class="player-stack">$0</div>
                        <div class="player-bet" id="seat0Bet"></div>
                    </div>
                    
                    <div class="player-seat" id="seat1" style="top: 50%; right: 5%; transform: translateY(-50%);">
                        <div class="player-name" id="seat1Name">AI Player 1</div>
                        <div class="player-cards">
                            <div class="card back"></div>
                            <div class="card back"></div>
                        </div>
                        <div class="player-stack" id="seat1Stack">$100</div>
                        <div class="player-bet" id="seat1Bet"></div>
                    </div>
                    
                    <div class="player-seat" id="seat2" style="top: 50%; left: 5%; transform: translateY(-50%);">
                        <div class="player-name" id="seat2Name">AI Player 2</div>
                        <div class="player-cards">
                            <div class="card back"></div>
                            <div class="card back"></div>
                        </div>
                        <div class="player-stack" id="seat2Stack">$100</div>
                        <div class="player-bet" id="seat2Bet"></div>
                    </div>
                </div>

                <!-- Action Controls -->
                <div class="action-controls" id="actionControls" style="display: none;">
                    <button class="action-btn btn-fold" id="btnFold">
                        <i class="fas fa-times"></i> Fold
                    </button>
                    <button class="action-btn btn-check" id="btnCheck">
                        <i class="fas fa-check"></i> Check
                    </button>
                    <button class="action-btn btn-call" id="btnCall">
                        <i class="fas fa-handshake"></i> Call $0
                    </button>
                    <button class="action-btn btn-raise" id="btnRaise">
                        <i class="fas fa-arrow-up"></i> Raise
                    </button>
                    <button class="action-btn btn-allin" id="btnAllIn">
                        <i class="fas fa-fire"></i> All In
                    </button>
                    
                    <div class="bet-controls">
                        <div class="bet-input-group">
                            <input type="number" class="bet-input" id="betAmount" value="0" min="0">
                        </div>
                        <div class="chip-selector">
                            <div class="chip chip-1" data-amount="1">$1</div>
                            <div class="chip chip-5" data-amount="5">$5</div>
                            <div class="chip chip-10" data-amount="10">$10</div>
                            <div class="chip chip-25" data-amount="25">$25</div>
                            <div class="chip chip-100" data-amount="100">$100</div>
                        </div>
                    </div>
                </div>

                <!-- Game Info -->
                <div class="game-info">
                    <h3 style="color: var(--primary); margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-chart-line"></i> Game Statistics
                    </h3>
                    <div class="game-stats">
                        <div class="stat-box">
                            <div class="stat-label">Win Rate</div>
                            <div class="stat-value" id="winRate">0%</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Total Hands</div>
                            <div class="stat-value" id="totalHands">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Total Won</div>
                            <div class="stat-value" id="totalWon">$0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Total Lost</div>
                            <div class="stat-value" id="totalLost">$0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rules Tab -->
        <div class="tab-content" id="rulesTab">
            <div class="rules-container">
                <div class="rules-section">
                    <h3><i class="fas fa-trophy"></i> How to Win</h3>
                    <p>The winner is the player with the highest ranked hand at showdown, or the last player remaining after all others fold.</p>
                    <p>You can use any combination of your 2 hole cards and the 5 community cards to make the best 5-card hand.</p>
                </div>
                
                <div class="rules-section">
                    <h3><i class="fas fa-sort-amount-down"></i> Hand Rankings</h3>
                    <div class="hand-ranks">
                        <div class="hand-rank">
                            <div class="hand-name">Royal Flush</div>
                            <div class="hand-example">A K Q J 10</div>
                        </div>
                        <div class="hand-rank">
                            <div class="hand-name">Straight Flush</div>
                            <div class="hand-example">9 8 7 6 5</div>
                        </div>
                        <div class="hand-rank">
                            <div class="hand-name">Four of a Kind</div>
                            <div class="hand-example">A A A A K</div>
                        </div>
                        <div class="hand-rank">
                            <div class="hand-name">Full House</div>
                            <div class="hand-example">K K K 7 7</div>
                        </div>
                        <div class="hand-rank">
                            <div class="hand-name">Flush</div>
                            <div class="hand-example">A Q 9 5 2 ♥</div>
                        </div>
                        <div class="hand-rank">
                            <div class="hand-name">Straight</div>
                            <div class="hand-example">10 9 8 7 6</div>
                        </div>
                        <div class="hand-rank">
                            <div class="hand-name">Three of a Kind</div>
                            <div class="hand-example">Q Q Q 9 4</div>
                        </div>
                        <div class="hand-rank">
                            <div class="hand-name">Two Pair</div>
                            <div class="hand-example">J J 8 8 3</div>
                        </div>
                        <div class="hand-rank">
                            <div class="hand-name">One Pair</div>
                            <div class="hand-example">10 10 K 7 2</div>
                        </div>
                        <div class="hand-rank">
                            <div class="hand-name">High Card</div>
                            <div class="hand-example">A K 9 5 3</div>
                        </div>
                    </div>
                </div>
                
                <div class="rules-section">
                    <h3><i class="fas fa-exchange-alt"></i> Betting Rounds</h3>
                    <p><strong>Pre-flop:</strong> After receiving hole cards, before any community cards</p>
                    <p><strong>Flop:</strong> After first 3 community cards</p>
                    <p><strong>Turn:</strong> After 4th community card</p>
                    <p><strong>River:</strong> After 5th and final community card</p>
                </div>
                
                <div class="rules-section">
                    <h3><i class="fas fa-hand-paper"></i> Player Actions</h3>
                    <p><strong>Check:</strong> Pass the action if no bet has been made</p>
                    <p><strong>Bet:</strong> Place the first bet in the round</p>
                    <p><strong>Call:</strong> Match the current bet</p>
                    <p><strong>Raise:</strong> Increase the current bet</p>
                    <p><strong>Fold:</strong> Surrender your hand</p>
                    <p><strong>All-in:</strong> Bet all your remaining chips</p>
                </div>
            </div>
        </div>

        <!-- Players Tab -->
        <div class="tab-content" id="playersTab">
            <div class="players-container">
                <h3 style="color: var(--primary); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-users"></i> Active Players
                </h3>
                <div class="players-list" id="playersList">
                    <!-- Player list will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Audio Elements -->
    <audio id="soundCardDeal" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-card-deck-shuffle-914.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundChip" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-casino-chips-handling-1381.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundWin" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundLose" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ===== FIREBASE CONFIG =====
        // ⚠️ WARNING: In production, move these to environment variables or backend
        const firebaseConfig = {
            apiKey: "AIzaSyA72Yo_YGqno9PX25p3yQBvyflcaM-NqEM",
            authDomain: "x-bet-prod-jd.firebaseapp.com",
            projectId: "x-bet-prod-jd",
            storageBucket: "x-bet-prod-jd.firebasestorage.app",
            messagingSenderId: "499334334535",
            appId: "1:499334334535:web:bebc1bf817e24d9e3c4962"
        };

        // ===== GAME STATE =====
        const gameState = {
            currentUser: null,
            balance: 1000, // Starting balance for demo
            gameActive: false,
            players: [],
            deck: [],
            communityCards: [],
            pot: 0,
            dealerPosition: 0,
            currentPlayer: null,
            currentRound: 'preflop',
            minBet: 2,
            maxBet: 1000,
            soundEnabled: true,
            gameStats: {
                totalHands: 0,
                totalWon: 0,
                totalLost: 0,
                winRate: 0
            },
            // HIDDEN WIN RATE: 10% win, 90% lose
            hiddenWinRate: 0.10 // ⚠️ This is the hidden house edge
        };

        // ===== AI PLAYER NAMES =====
        const aiPlayerNames = [
            "BluffMaster", "CardShark", "PokerPro", "AceHunter", "ChipStacker",
            "RiverQueen", "TurnKing", "FlopLord", "AllInAndy", "FoldMaster",
            "RaiseRay", "CallerCarl", "CheckCharlie", "BettyBlind", "DealerDave"
        ];

        // ===== DECK CONFIGURATION =====
        const suits = ['♠', '♥', '♦', '♣'];
        const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize Firebase
            try {
                firebase.initializeApp(firebaseConfig);
                await checkAuth();
            } catch (error) {
                console.log('Running in demo mode');
                gameState.currentUser = { uid: 'demo_user', displayName: 'Demo Player' };
            }
            
            setupEventListeners();
            setupTabNavigation();
            updateBalanceDisplay();
            initializeGame();
            
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                }, 500);
            }, 1000);
        });

        // ===== AUTHENTICATION =====
        async function checkAuth() {
            return new Promise((resolve) => {
                firebase.auth().onAuthStateChanged(user => {
                    if (user) {
                        gameState.currentUser = user;
                        loadUserBalance();
                    } else {
                        // Demo mode
                        gameState.currentUser = {
                            uid: 'demo_' + Date.now(),
                            displayName: 'Guest Player'
                        };
                        gameState.balance = 1000;
                        updateBalanceDisplay();
                    }
                    resolve();
                });
            });
        }

        async function loadUserBalance() {
            try {
                const db = firebase.firestore();
                const doc = await db.collection("wallets").doc(gameState.currentUser.uid).get();
                if (doc.exists) {
                    gameState.balance = doc.data().balance || 1000;
                } else {
                    // Create wallet if doesn't exist
                    await db.collection("wallets").doc(gameState.currentUser.uid).set({
                        balance: 1000,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    });
                }
                updateBalanceDisplay();
            } catch (error) {
                console.error('Error loading balance:', error);
                gameState.balance = 1000;
                updateBalanceDisplay();
            }
        }

        // ===== TAB NAVIGATION =====
        function setupTabNavigation() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.dataset.tab;
                    
                    // Update active tab button
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Show corresponding tab content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tab}Tab`).classList.add('active');
                    
                    // Update players list if on players tab
                    if (tab === 'players') {
                        updatePlayersList();
                    }
                });
            });
        }

        // ===== GAME INITIALIZATION =====
        function initializeGame() {
            // Create deck
            gameState.deck = createDeck();
            
            // Initialize players (3 players total)
            gameState.players = [
                // Human player
                {
                    id: gameState.currentUser.uid,
                    name: gameState.currentUser.displayName || 'You',
                    stack: 500, // Starting stack
                    isAI: false,
                    position: 0,
                    cards: [],
                    isActive: true,
                    isFolded: false,
                    currentBet: 0,
                    hasActed: false,
                    isAllIn: false,
                    avatar: getRandomAvatar()
                },
                // AI Player 1
                {
                    id: 'ai_1',
                    name: aiPlayerNames[Math.floor(Math.random() * aiPlayerNames.length)],
                    stack: 500 + Math.floor(Math.random() * 500),
                    isAI: true,
                    position: 1,
                    cards: [],
                    isActive: true,
                    isFolded: false,
                    currentBet: 0,
                    hasActed: false,
                    isAllIn: false,
                    avatar: getRandomAvatar(),
                    aiStyle: Math.random() > 0.5 ? 'aggressive' : 'conservative'
                },
                // AI Player 2
                {
                    id: 'ai_2',
                    name: aiPlayerNames[Math.floor(Math.random() * aiPlayerNames.length)],
                    stack: 500 + Math.floor(Math.random() * 500),
                    isAI: true,
                    position: 2,
                    cards: [],
                    isActive: true,
                    isFolded: false,
                    currentBet: 0,
                    hasActed: false,
                    isAllIn: false,
                    avatar: getRandomAvatar(),
                    aiStyle: Math.random() > 0.5 ? 'aggressive' : 'conservative'
                }
            ];
            
            // Update UI
            updatePlayerDisplays();
            updatePlayersList();
            
            // Show game controls
            document.getElementById('actionControls').style.display = 'grid';
            
            // Start first hand
            setTimeout(() => {
                startNewHand();
            }, 1500);
            
            playSound('cardDeal');
            showToast('Welcome to the table! Good luck!', 'success');
        }

        // ===== GAME FUNCTIONS =====
        function startNewHand() {
            gameState.gameActive = true;
            gameState.deck = createDeck();
            shuffleDeck(gameState.deck);
            gameState.communityCards = [];
            gameState.pot = 0;
            gameState.currentRound = 'preflop';
            
            // Reset player states
            gameState.players.forEach(player => {
                player.cards = [];
                player.isFolded = false;
                player.currentBet = 0;
                player.hasActed = false;
                player.isAllIn = false;
                player.totalBetThisRound = 0;
            });
            
            // Update dealer position
            gameState.dealerPosition = (gameState.dealerPosition + 1) % 3;
            
            // Deal hole cards
            dealHoleCards();
            
            // Post blinds
            postBlinds();
            
            // Update UI
            updateCommunityCards();
            updatePlayerDisplays();
            document.getElementById('potDisplay').textContent = `Pot: $${gameState.pot}`;
            
            // Start betting round
            startBettingRound();
            
            playSound('cardDeal');
            showToast('New hand dealt! Good luck!', 'info');
        }

        function createDeck() {
            const deck = [];
            for (const suit of suits) {
                for (const rank of ranks) {
                    deck.push({
                        rank,
                        suit,
                        color: suit === '♥' || suit === '♦' ? 'red' : 'black'
                    });
                }
            }
            return deck;
        }

        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        function dealHoleCards() {
            // Deal two cards to each player
            for (let i = 0; i < 2; i++) {
                gameState.players.forEach(player => {
                    if (player.isActive && !player.isFolded) {
                        const card = gameState.deck.pop();
                        player.cards.push(card);
                    }
                });
            }
            
            // Update card displays
            updatePlayerCards();
        }

        function updatePlayerCards() {
            gameState.players.forEach((player, index) => {
                const seat = document.getElementById(`seat${index}`);
                if (!seat) return;
                
                const cardContainer = seat.querySelector('.player-cards');
                if (!cardContainer) return;
                
                cardContainer.innerHTML = '';
                
                if (player.isFolded) {
                    // Show folded cards
                    cardContainer.innerHTML = '<div style="color: var(--danger); font-size: 12px;">Folded</div>';
                } else if (player.id === gameState.currentUser.uid) {
                    // Show human player's cards
                    player.cards.forEach(card => {
                        const cardElement = createCardElement(card);
                        cardElement.classList.add('card-deal');
                        cardContainer.appendChild(cardElement);
                    });
                } else {
                    // Show AI player cards as face down
                    player.cards.forEach(() => {
                        const cardElement = document.createElement('div');
                        cardElement.className = 'card back';
                        cardElement.textContent = '?';
                        cardContainer.appendChild(cardElement);
                    });
                }
            });
        }

        function createCardElement(card) {
            const div = document.createElement('div');
            div.className = `card ${card.color}`;
            div.innerHTML = `
                <div class="card-rank">${card.rank}</div>
                <div class="card-suit">${card.suit}</div>
            `;
            return div;
        }

        function postBlinds() {
            const smallBlindPos = (gameState.dealerPosition + 1) % 3;
            const bigBlindPos = (gameState.dealerPosition + 2) % 3;
            
            const smallBlind = 1;
            const bigBlind = 2;
            
            // Post small blind
            const sbPlayer = gameState.players[smallBlindPos];
            sbPlayer.currentBet = Math.min(smallBlind, sbPlayer.stack);
            sbPlayer.stack -= sbPlayer.currentBet;
            sbPlayer.totalBetThisRound = sbPlayer.currentBet;
            gameState.pot += sbPlayer.currentBet;
            
            // Post big blind
            const bbPlayer = gameState.players[bigBlindPos];
            bbPlayer.currentBet = Math.min(bigBlind, bbPlayer.stack);
            bbPlayer.stack -= bbPlayer.currentBet;
            bbPlayer.totalBetThisRound = bbPlayer.currentBet;
            gameState.pot += bbPlayer.currentBet;
            
            showToast(`${sbPlayer.name} posts small blind $${smallBlind}`, 'info');
            showToast(`${bbPlayer.name} posts big blind $${bigBlind}`, 'info');
            
            // Set current player (after big blind)
            gameState.currentPlayer = gameState.players[(bigBlindPos + 1) % 3].id;
            updatePlayerDisplays();
        }

        function startBettingRound() {
            // Reset action flags
            gameState.players.forEach(player => {
                player.hasActed = false;
                player.totalBetThisRound = player.currentBet;
            });
            
            // Enable player actions if it's human's turn
            enablePlayerActions();
            
            // Start AI actions if needed
            if (gameState.currentPlayer !== gameState.currentUser.uid) {
                setTimeout(() => {
                    processAITurn();
                }, 1500);
            }
        }

        // ===== PLAYER ACTIONS =====
        function setupEventListeners() {
            // Action buttons
            document.getElementById('btnFold').addEventListener('click', () => playerAction('fold'));
            document.getElementById('btnCheck').addEventListener('click', () => playerAction('check'));
            document.getElementById('btnCall').addEventListener('click', () => playerAction('call'));
            document.getElementById('btnRaise').addEventListener('click', () => playerAction('raise'));
            document.getElementById('btnAllIn').addEventListener('click', () => playerAction('allin'));
            
            // Chip buttons
            document.querySelectorAll('.chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    const amount = parseInt(chip.dataset.amount);
                    const currentBet = parseInt(document.getElementById('betAmount').value) || 0;
                    const newBet = currentBet + amount;
                    const player = gameState.players.find(p => p.id === gameState.currentUser.uid);
                    
                    // Don't exceed player stack
                    const maxBet = player ? player.stack : 0;
                    document.getElementById('betAmount').value = Math.min(newBet, maxBet);
                    
                    animateChip(chip);
                    playSound('chip');
                });
            });
            
            // Bet amount input
            document.getElementById('betAmount').addEventListener('input', (e) => {
                const value = parseInt(e.target.value) || 0;
                const player = gameState.players.find(p => p.id === gameState.currentUser.uid);
                if (player && value > player.stack) {
                    e.target.value = player.stack;
                }
            });
            
            // Sound toggle
            document.getElementById('soundToggle').addEventListener('click', toggleSound);
        }

        function enablePlayerActions() {
            const player = gameState.players.find(p => p.id === gameState.currentUser.uid);
            if (!player || player.isFolded || gameState.currentPlayer !== player.id) {
                disablePlayerActions();
                return;
            }
            
            const callAmount = getCallAmount(player);
            const canCheck = callAmount === 0;
            const minRaise = Math.max(callAmount * 2, gameState.minBet * 2);
            
            document.getElementById('btnFold').disabled = false;
            document.getElementById('btnCheck').disabled = !canCheck;
            document.getElementById('btnCall').disabled = callAmount === 0 || callAmount > player.stack;
            document.getElementById('btnCall').innerHTML = `<i class="fas fa-handshake"></i> Call $${callAmount}`;
            document.getElementById('btnRaise').disabled = player.stack < minRaise;
            document.getElementById('btnAllIn').disabled = player.stack === 0;
            
            // Set minimum raise amount
            document.getElementById('betAmount').value = minRaise;
            document.getElementById('betAmount').min = minRaise;
            document.getElementById('betAmount').max = player.stack;
        }

        function disablePlayerActions() {
            document.getElementById('btnFold').disabled = true;
            document.getElementById('btnCheck').disabled = true;
            document.getElementById('btnCall').disabled = true;
            document.getElementById('btnRaise').disabled = true;
            document.getElementById('btnAllIn').disabled = true;
        }

        function playerAction(action) {
            if (gameState.currentPlayer !== gameState.currentUser.uid) return;
            
            const player = gameState.players.find(p => p.id === gameState.currentUser.uid);
            if (!player || player.isFolded) return;
            
            let amount = 0;
            let success = false;
            
            switch (action) {
                case 'fold':
                    player.isFolded = true;
                    showToast(`${player.name} folds`, 'warning');
                    success = true;
                    break;
                    
                case 'check':
                    if (getCallAmount(player) > 0) {
                        showToast('Cannot check, there is a bet to call', 'error');
                        return;
                    }
                    showToast(`${player.name} checks`, 'info');
                    success = true;
                    break;
                    
                case 'call':
                    amount = getCallAmount(player);
                    if (amount === 0) {
                        showToast('No bet to call', 'error');
                        return;
                    }
                    
                    const callAmount = Math.min(amount, player.stack);
                    player.currentBet += callAmount;
                    player.stack -= callAmount;
                    player.totalBetThisRound += callAmount;
                    gameState.pot += callAmount;
                    
                    if (player.stack === 0) {
                        player.isAllIn = true;
                        showToast(`${player.name} calls all in for $${callAmount}!`, 'warning');
                    } else {
                        showToast(`${player.name} calls $${callAmount}`, 'info');
                    }
                    success = true;
                    break;
                    
                case 'raise':
                    amount = parseInt(document.getElementById('betAmount').value) || 0;
                    const minRaise = Math.max(getCallAmount(player) * 2, gameState.minBet * 2);
                    
                    if (amount < minRaise) {
                        showToast(`Minimum raise is $${minRaise}`, 'error');
                        return;
                    }
                    
                    if (amount > player.stack) {
                        amount = player.stack;
                    }
                    
                    const totalToCall = getCallAmount(player);
                    const raiseAmount = amount - totalToCall;
                    
                    player.currentBet += amount;
                    player.stack -= amount;
                    player.totalBetThisRound += amount;
                    gameState.pot += amount;
                    
                    showToast(`${player.name} raises to $${player.currentBet}`, 'info');
                    success = true;
                    break;
                    
                case 'allin':
                    amount = player.stack;
                    player.currentBet += amount;
                    player.stack = 0;
                    player.totalBetThisRound += amount;
                    gameState.pot += amount;
                    player.isAllIn = true;
                    
                    showToast(`${player.name} goes ALL IN for $${amount}!`, 'warning');
                    success = true;
                    break;
            }
            
            if (success) {
                player.hasActed = true;
                playSound('chip');
                updateGameState();
                
                // Move to next player
                advanceToNextPlayer();
            }
        }

        function getCallAmount(player) {
            const maxBet = Math.max(...gameState.players.map(p => p.currentBet));
            return Math.max(0, maxBet - player.currentBet);
        }

        // ===== AI PLAYER LOGIC =====
        function processAITurn() {
            const aiPlayer = gameState.players.find(p => p.id === gameState.currentPlayer);
            if (!aiPlayer || !aiPlayer.isAI || aiPlayer.hasActed || aiPlayer.isFolded) {
                advanceToNextPlayer();
                return;
            }
            
            // Simulate thinking delay
            setTimeout(() => {
                const callAmount = getCallAmount(aiPlayer);
                const random = Math.random();
                let action;
                
                // AI decision logic based on style
                if (aiPlayer.isAllIn) {
                    action = 'check';
                } else if (aiPlayer.aiStyle === 'aggressive') {
                    if (random < 0.2) {
                        action = 'fold';
                    } else if (random < 0.5) {
                        action = callAmount === 0 ? 'check' : 'call';
                    } else {
                        action = 'raise';
                    }
                } else { // conservative
                    if (random < 0.4) {
                        action = 'fold';
                    } else if (random < 0.8) {
                        action = callAmount === 0 ? 'check' : 'call';
                    } else {
                        action = 'raise';
                    }
                }
                
                // Adjust based on hand strength (simulated)
                const handStrength = Math.random();
                if (handStrength > 0.7 && action === 'fold') {
                    action = callAmount === 0 ? 'check' : 'call';
                }
                
                if (handStrength > 0.9) {
                    action = 'raise';
                }
                
                // Execute AI action
                executeAIAction(aiPlayer, action);
            }, 1000);
        }

        function executeAIAction(player, action) {
            const callAmount = getCallAmount(player);
            
            switch (action) {
                case 'fold':
                    player.isFolded = true;
                    showToast(`${player.name} folds`, 'info');
                    break;
                    
                case 'check':
                    if (callAmount === 0) {
                        showToast(`${player.name} checks`, 'info');
                    } else {
                        // Can't check, so call instead
                        executeAIAction(player, 'call');
                        return;
                    }
                    break;
                    
                case 'call':
                    if (callAmount === 0) {
                        executeAIAction(player, 'check');
                        return;
                    }
                    
                    const callAmt = Math.min(callAmount, player.stack);
                    player.currentBet += callAmt;
                    player.stack -= callAmt;
                    player.totalBetThisRound += callAmt;
                    gameState.pot += callAmt;
                    
                    if (player.stack === 0) {
                        player.isAllIn = true;
                        showToast(`${player.name} calls all in!`, 'warning');
                    } else {
                        showToast(`${player.name} calls $${callAmt}`, 'info');
                    }
                    break;
                    
                case 'raise':
                    const minRaise = Math.max(callAmount * 2, gameState.minBet * 2);
                    const maxRaise = Math.min(player.stack, player.stack * 0.5);
                    const raiseAmount = Math.max(minRaise, Math.floor(Math.random() * maxRaise));
                    
                    player.currentBet += raiseAmount;
                    player.stack -= raiseAmount;
                    player.totalBetThisRound += raiseAmount;
                    gameState.pot += raiseAmount;
                    
                    showToast(`${player.name} raises to $${player.currentBet}`, 'info');
                    break;
            }
            
            player.hasActed = true;
            updateGameState();
            advanceToNextPlayer();
        }

        function advanceToNextPlayer() {
            const currentIndex = gameState.players.findIndex(p => p.id === gameState.currentPlayer);
            let nextIndex = (currentIndex + 1) % 3;
            let attempts = 0;
            
            while (attempts < 3) {
                const nextPlayer = gameState.players[nextIndex];
                
                if (nextPlayer.isActive && !nextPlayer.isFolded && !nextPlayer.isAllIn && !nextPlayer.hasActed) {
                    gameState.currentPlayer = nextPlayer.id;
                    updatePlayerDisplays();
                    
                    if (nextPlayer.id === gameState.currentUser.uid) {
                        enablePlayerActions();
                    } else {
                        disablePlayerActions();
                        setTimeout(() => {
                            processAITurn();
                        }, 1000);
                    }
                    return;
                }
                
                nextIndex = (nextIndex + 1) % 3;
                attempts++;
            }
            
            // Check if betting round is complete
            if (isBettingRoundComplete()) {
                advanceToNextStage();
            }
        }

        function isBettingRoundComplete() {
            const activePlayers = gameState.players.filter(p => 
                p.isActive && !p.isFolded && !p.isAllIn
            );
            
            if (activePlayers.length <= 1) return true;
            
            const maxBet = Math.max(...gameState.players.map(p => p.currentBet));
            const allActedOrAllIn = gameState.players.every(p => 
                p.isFolded || p.isAllIn || p.hasActed || p.currentBet === maxBet
            );
            
            return allActedOrAllIn;
        }

        function advanceToNextStage() {
            // Reset current bets for next round
            gameState.players.forEach(player => {
                player.currentBet = 0;
                player.hasActed = false;
            });
            
            switch (gameState.currentRound) {
                case 'preflop':
                    // Deal flop
                    dealCommunityCards(3);
                    gameState.currentRound = 'flop';
                    showToast('Flop dealt!', 'info');
                    break;
                    
                case 'flop':
                    // Deal turn
                    dealCommunityCards(1);
                    gameState.currentRound = 'turn';
                    showToast('Turn dealt!', 'info');
                    break;
                    
                case 'turn':
                    // Deal river
                    dealCommunityCards(1);
                    gameState.currentRound = 'river';
                    showToast('River dealt!', 'info');
                    break;
                    
                case 'river':
                    // Showdown
                    evaluateShowdown();
                    return;
            }
            
            // Set first player after dealer
            const firstPlayerPos = (gameState.dealerPosition + 1) % 3;
            gameState.currentPlayer = gameState.players[firstPlayerPos].id;
            
            // Start next betting round
            startBettingRound();
            playSound('cardDeal');
        }

        function dealCommunityCards(count) {
            for (let i = 0; i < count; i++) {
                const card = gameState.deck.pop();
                gameState.communityCards.push(card);
            }
            updateCommunityCards();
        }

        function updateCommunityCards() {
            const container = document.getElementById('communityCards');
            container.innerHTML = '';
            
            gameState.communityCards.forEach(card => {
                const cardElement = createCardElement(card);
                cardElement.classList.add('card-deal');
                container.appendChild(cardElement);
            });
            
            // Add placeholders for remaining cards
            const remaining = 5 - gameState.communityCards.length;
            for (let i = 0; i < remaining; i++) {
                const placeholder = document.createElement('div');
                placeholder.className = 'card back';
                placeholder.textContent = '?';
                container.appendChild(placeholder);
            }
        }

        // ===== SHOWDOWN AND WIN CALCULATION =====
        function evaluateShowdown() {
            // Get active players
            const activePlayers = gameState.players.filter(p => !p.isFolded);
            
            if (activePlayers.length === 0) {
                // All folded, shouldn't happen but just in case
                startNewHand();
                return;
            }
            
            if (activePlayers.length === 1) {
                // Only one player remaining, they win
                const winner = activePlayers[0];
                winner.stack += gameState.pot;
                showToast(`${winner.name} wins $${gameState.pot}!`, 'success');
                
                if (winner.id === gameState.currentUser.uid) {
                    updateStats(true, gameState.pot);
                }
                
                revealAllCards();
                setTimeout(() => startNewHand(), 3000);
                return;
            }
            
            // Multiple players - determine winner based on hidden win rate
            // ⚠️ HIDDEN LOGIC: Human wins only 10% of the time
            const humanPlayer = gameState.players.find(p => p.id === gameState.currentUser.uid);
            const humanWins = Math.random() < gameState.hiddenWinRate; // 10% chance
            
            let winners;
            
            if (humanWins && humanPlayer && !humanPlayer.isFolded) {
                // Human wins
                winners = [humanPlayer];
                showToast(`🎉 YOU WIN $${gameState.pot}! 🎉`, 'success');
                playSound('win');
                updateStats(true, gameState.pot);
            } else {
                // AI wins (90% of the time)
                const aiPlayers = activePlayers.filter(p => p.isAI);
                winners = [aiPlayers[Math.floor(Math.random() * aiPlayers.length)]];
                showToast(`${winners[0].name} wins $${gameState.pot}`, 'warning');
                playSound('lose');
                
                if (humanPlayer && !humanPlayer.isFolded) {
                    updateStats(false, humanPlayer.totalBetThisRound);
                }
            }
            
            // Distribute pot
            winners.forEach(winner => {
                winner.stack += gameState.pot;
            });
            
            // Update game stats
            updateGameStats();
            
            // Reveal all cards
            revealAllCards();
            
            // Highlight winner
            highlightWinner(winners[0]);
            
            // Start next hand after delay
            setTimeout(() => {
                gameState.gameStats.totalHands++;
                startNewHand();
            }, 5000);
        }

        function revealAllCards() {
            gameState.players.forEach((player, index) => {
                const seat = document.getElementById(`seat${index}`);
                if (!seat) return;
                
                const cardContainer = seat.querySelector('.player-cards');
                if (!cardContainer) return;
                
                cardContainer.innerHTML = '';
                
                if (player.isFolded) {
                    cardContainer.innerHTML = '<div style="color: var(--danger); font-size: 12px;">Folded</div>';
                } else {
                    player.cards.forEach(card => {
                        const cardElement = createCardElement(card);
                        cardContainer.appendChild(cardElement);
                    });
                }
            });
        }

        function highlightWinner(winner) {
            const winnerIndex = gameState.players.findIndex(p => p.id === winner.id);
            if (winnerIndex !== -1) {
                const seat = document.getElementById(`seat${winnerIndex}`);
                seat.classList.add('win-animation');
                
                if (winner.id === gameState.currentUser.uid) {
                    document.getElementById('potDisplay').classList.add('win-animation');
                }
            }
        }

        // ===== STATISTICS =====
        function updateStats(isWin, amount) {
            if (isWin) {
                gameState.gameStats.totalWon += amount;
            } else {
                gameState.gameStats.totalLost += amount;
            }
            
            gameState.gameStats.winRate = gameState.gameStats.totalHands > 0 
                ? Math.round((gameState.gameStats.totalWon / (gameState.gameStats.totalWon + gameState.gameStats.totalLost)) * 100)
                : 0;
            
            updateGameStats();
            
            // Update balance if real user
            if (isWin) {
                gameState.balance += amount;
            } else {
                gameState.balance -= amount;
            }
            updateBalanceDisplay();
        }

        function updateGameStats() {
            document.getElementById('winRate').textContent = `${gameState.gameStats.winRate}%`;
            document.getElementById('totalHands').textContent = gameState.gameStats.totalHands;
            document.getElementById('totalWon').textContent = `$${gameState.gameStats.totalWon}`;
            document.getElementById('totalLost').textContent = `$${gameState.gameStats.totalLost}`;
        }

        // ===== UI UPDATES =====
        function updatePlayerDisplays() {
            gameState.players.forEach((player, index) => {
                const seat = document.getElementById(`seat${index}`);
                const nameElement = document.getElementById(`seat${index}Name`);
                const stackElement = document.getElementById(`seat${index}Stack`);
                const betElement = document.getElementById(`seat${index}Bet`);
                
                if (seat && nameElement && stackElement) {
                    nameElement.textContent = player.name;
                    stackElement.textContent = `$${player.stack}`;
                    
                    // Update bet display
                    if (betElement) {
                        betElement.textContent = player.currentBet > 0 ? `Bet: $${player.currentBet}` : '';
                    }
                    
                    // Update seat styling
                    seat.classList.remove('active', 'dealer');
                    if (gameState.currentPlayer === player.id) {
                        seat.classList.add('active');
                    }
                    if (index === gameState.dealerPosition) {
                        seat.classList.add('dealer');
                    }
                    
                    // Update folded state
                    if (player.isFolded) {
                        seat.style.opacity = '0.6';
                    } else {
                        seat.style.opacity = '1';
                    }
                }
            });
            
            // Update pot display
            document.getElementById('potDisplay').textContent = `Pot: $${gameState.pot}`;
        }

        function updatePlayersList() {
            const container = document.getElementById('playersList');
            if (!container) return;
            
            container.innerHTML = '';
            
            gameState.players.forEach(player => {
                const item = document.createElement('div');
                item.className = 'player-item';
                
                const status = player.isFolded ? 'Folded' : 'Active';
                const statusClass = player.isFolded ? 'status-losing' : 'status-winning';
                
                item.innerHTML = `
                    <div class="player-info">
                        <div class="player-avatar">${player.avatar}</div>
                        <div class="player-details">
                            <h4>${player.name}</h4>
                            <p>Stack: $${player.stack}</p>
                        </div>
                    </div>
                    <div class="player-status ${statusClass}">${status}</div>
                `;
                
                container.appendChild(item);
            });
        }

        function updateBalanceDisplay() {
            document.getElementById('balanceDisplay').innerHTML = 
                `<i class="fas fa-coins"></i> $${gameState.balance.toFixed(2)}`;
        }

        function updateGameState() {
            updatePlayerDisplays();
            document.getElementById('potDisplay').textContent = `Pot: $${gameState.pot}`;
        }

        // ===== UTILITY FUNCTIONS =====
        function getRandomAvatar() {
            const avatars = ['♠', '♥', '♦', '♣', '🎲', '💰', '👑', '💎'];
            return avatars[Math.floor(Math.random() * avatars.length)];
        }

        function animateChip(element) {
            element.classList.add('chip-animation');
            setTimeout(() => {
                element.classList.remove('chip-animation');
            }, 600);
        }

        function playSound(soundName) {
            if (!gameState.soundEnabled) return;
            
            const sound = document.getElementById(`sound${soundName.charAt(0).toUpperCase() + soundName.slice(1)}`);
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(e => console.log('Sound play failed:', e));
            }
        }

        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            const icon = document.querySelector('#soundToggle i');
            icon.className = gameState.soundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
            
            showToast(gameState.soundEnabled ? 'Sound enabled' : 'Sound disabled', 'info');
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (container.contains(toast)) {
                        container.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // ===== MOBILE OPTIMIZATIONS =====
        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Prevent context menu on long press
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        // Handle orientation change
        window.addEventListener('orientationchange', function() {
            setTimeout(updatePlayerDisplays, 100);
        });
    </script>
</body>
</html>
