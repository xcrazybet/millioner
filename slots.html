<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Slots Game</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<style>
body {
  background:#0b0f1a;
  color:#fff;
  font-family:Arial, sans-serif;
  text-align:center;
}
.container {
  max-width:420px;
  margin:auto;
  padding:20px;
}
.balance {
  margin:10px 0;
  font-size:18px;
}
.slot {
  display:flex;
  justify-content:space-between;
  background:#111;
  padding:20px;
  border-radius:12px;
  margin:20px 0;
}
.reel {
  width:90px;
  height:90px;
  font-size:48px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000;
  border-radius:10px;
}
.spin {
  animation: spin 0.3s linear infinite;
}
@keyframes spin {
  from {transform:translateY(0);}
  to {transform:translateY(20px);}
}
.controls button {
  width:100%;
  padding:12px;
  font-size:18px;
  background:#f0a500;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
.controls button:disabled {
  opacity:0.5;
}
input {
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:6px;
  border:none;
}
.message {
  margin-top:15px;
  font-size:16px;
}
.win {
  color:#00ff9c;
}
.lose {
  color:#ff4d4d;
}
</style>
</head>

<body>
<div class="container">
  <h2>üé∞ SLOT MACHINE</h2>

  <div class="balance">Balance: $<span id="balance">0</span></div>

  <input type="number" id="bet" placeholder="Enter bet" min="1"/>

  <div class="slot">
    <div class="reel" id="r1">üçí</div>
    <div class="reel" id="r2">üçí</div>
    <div class="reel" id="r3">üçí</div>
  </div>

  <div class="controls">
    <button id="spinBtn">SPIN</button>
  </div>

  <div class="message" id="message"></div>
</div>

<script>
/* üî• REPLACE WITH YOUR EXISTING FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID"
});

const auth = firebase.auth();
const db = firebase.firestore();

const symbols = ["üçí","üçã","üçâ","‚≠ê","üíé","üîî","üÉè","üéÅ","üî•"];
const winRate = 0.15;

const payouts = {
  "üçí":2,
  "üçã":2.5,
  "üçâ":5,
  "‚≠ê":10,
  "üíé":25,
  "üîî":100
};

let userRef, walletRef, balance = 0, spinning=false;

auth.onAuthStateChanged(user=>{
  if(!user){
    location.href="login.html";
    return;
  }
  userRef = db.collection("wallets").doc(user.uid);
  walletRef = userRef;
  loadBalance();
});

async function loadBalance(){
  const snap = await walletRef.get();
  balance = snap.exists ? snap.data().balance : 0;
  document.getElementById("balance").innerText = balance.toFixed(2);
}

function randomSymbol(){
  return symbols[Math.floor(Math.random()*symbols.length)];
}

function setReels(spin=true){
  ["r1","r2","r3"].forEach(id=>{
    const el=document.getElementById(id);
    if(spin) el.classList.add("spin");
    else el.classList.remove("spin");
  });
}

document.getElementById("spinBtn").onclick = async ()=>{
  if(spinning) return;
  const bet = parseFloat(document.getElementById("bet").value);
  if(!bet || bet<=0 || bet>balance){
    alert("Invalid bet");
    return;
  }

  spinning=true;
  setReels(true);
  document.getElementById("spinBtn").disabled=true;
  document.getElementById("message").innerText="Spinning...";

  setTimeout(async ()=>{
    setReels(false);

    const isWin = Math.random() < winRate;
    let r1 = randomSymbol(), r2 = randomSymbol(), r3 = randomSymbol();
    let winAmount = 0, msg="", cls="lose";

    if(isWin){
      const base = randomSymbol();
      r1 = r2 = r3 = base;
      let mult = payouts[base] || 0;

      if(base==="üéÅ"){
        msg="üéÅ BONUS! 5 Free Spins!";
        cls="win";
      } else {
        winAmount = bet * mult;
        msg=`üéâ WIN $${winAmount.toFixed(2)}`;
        cls="win";
      }
    } else {
      msg="‚ùå You lost";
    }

    document.getElementById("r1").innerText=r1;
    document.getElementById("r2").innerText=r2;
    document.getElementById("r3").innerText=r3;

    await db.runTransaction(async t=>{
      const snap = await t.get(walletRef);
      let newBalance = snap.data().balance - bet + winAmount;
      t.update(walletRef,{balance:newBalance});
      t.set(walletRef.collection("transactions").doc(),{
        type:"slots",
        bet, winAmount,
        symbols:[r1,r2,r3],
        createdAt:firebase.firestore.FieldValue.serverTimestamp()
      });
      balance=newBalance;
    });

    document.getElementById("balance").innerText=balance.toFixed(2);
    document.getElementById("message").innerText=msg;
    document.getElementById("message").className="message "+cls;

    spinning=false;
    document.getElementById("spinBtn").disabled=false;

  },1400);
};
</script>
</body>
</html>
